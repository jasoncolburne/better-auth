FROM golang:1.25.1-bookworm AS builder

WORKDIR /app

# Copy go module files
COPY examples/basic/services/hsm/go.mod examples/basic/services/hsm/go.sum ./
RUN go mod download

# Copy source code
COPY examples/basic/services/hsm/*.go ./

# Build with verbose errors
RUN CGO_ENABLED=1 GOOS=linux go build -v -o hsm-server . || (cat /tmp/build.log 2>&1 || true)
