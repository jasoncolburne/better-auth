# better-auth

Examples given are encoded using CESR (Composable Event Streaming Representation) and ideas
surrounding forward secrecy came from KERI (Key Event Receipt Infrastructure)

The examples given were generated by the [reference typescript implementation](https://github.com/jasoncolburne/better-auth-ts)
which is a great place to learn more about how this works.

## Protocols

### Creation

generate a creation container on the server and deliver to client out of band

```json
{
  "payload": {
    "access": {
      "nonce": "0ADuGsJblnsLTdK_grEGuEqk",
      "responseKeyDigest": "EBobmrjOgamcKwN8zNuWCKH66lRo01ifxP5e8ZswLwun"
    },
    "response": {
      "creation": {
        "token": "ELHkb3DH-r205AedtF1qGnyAv4hf0wGnhWu2UTzObDdh"
      }
    }
  },
  "signature": "0IADUEYcExtCPQenqCniNy1JyemZwMyR0TVeL9kYYND_hRNhgHXVhxrYCp46GAiAe8Fq0Rmd4803Uxa_xpW6rC-h"
}
```

request

```json
{
  "payload": {
    "access": {
      "nonce": "0AA6VgIJnMGxa8uyUyMtVaSK"
    },
    "request": {
      "authentication": {
        "publicKeys": {
          "current": "1AAIA5aHXqJVvk0kO1rGSw3rFN6f4dSrZ2hZs-nKtYR5BPFe",
          "nextDigest": "EPZT6rGbAeKrRvD7iX1z_GW01gvXPUKj3Vt7on5EuHXH"
        }
      },
      "creation": {
        "token": "ELHkb3DH-r205AedtF1qGnyAv4hf0wGnhWu2UTzObDdh",
        "recoveryKeyDigest": "EBlR4Szox2WRSTxiUP_zIfG_8jMbnVmd0g_CLryixMKc"
      },
      "identification": {
        "deviceId": "EFIedBknRKs-xVO6NkzluP_XdFw27PVmzCVKQ1rC2ahY"
      }
    }
  },
  "signature": "0IADSNF7X9W7Tq8VmVkq_IxJRFbhq1FNrOFYhKcxVq576cOcveZlP8bMCiGMb3HoNpP-Uo95D5_OcMwo2JQHtJ9W"
}
```

response

```json
{
  "payload": {
    "access": {
      "nonce": "0AA6VgIJnMGxa8uyUyMtVaSK",
      "responseKeyDigest": "EBobmrjOgamcKwN8zNuWCKH66lRo01ifxP5e8ZswLwun"
    },
    "response": {
      "identification": {
        "accountId": "EEfoXt-P0hkc9oeWcuDvLlhpKzrW6cOArxkWMh4dHoTF"
      }
    }
  },
  "signature": "0IAJJZyhx48kHz-4WJ5hhLxF2w-cUFc14sHTLANnfIBeCiP7N92b-LplZvYZJOqfVWNYwCs9P3vaVUxutAc0wTOl"
}
```

### Recovery

request

```json
{
  "payload": {
    "access": {
      "nonce": "0ABnZiNiMXUzyAKLlfPHRI9z"
    },
    "request": {
      "authentication": {
        "publicKeys": {
          "current": "1AAIAoibcfhjmF3PTSTzct8s1nYuKRrIqOA0C1nPSKId-Ryx",
          "nextDigest": "EOj0pb9V6atw0HLTTQGUxhdt4jG8KBA3AEnJMzSwyHHN"
        }
      },
      "identification": {
        "accountId": "ENB0uEBQwvVSZeiFT8-sp2U6pKOzClApMTkf-ajW2_BA",
        "deviceId": "ELhPDn-NXnAQ8lh9naEiivPzGdXS4dOJKi8HjmyvJXmM"
      },
      "recovery": {
        "publicKey": "1AAIAsvMMRDc9qmD-KvBob90NlMYbCZpWrOT8_4ju96Gn2EI"
      }
    }
  },
  "signature": "0IC-QANHg6gv_mvG6zhpNzl4D37RgpHQ2udv694lYHeq-s8j6HPuKNrCu3iignwBmL-7oPLxLbdKNzFV2C3aAv2G"
}
```

response

```json
{
  "payload": {
    "access": {
      "nonce": "0ABnZiNiMXUzyAKLlfPHRI9z",
      "responseKeyDigest": "EFTV5EJyqrr0syOBgv0mo4LcvaD5Kj0DUSmu6GbhmEqJ"
    },
    "response": {}
  },
  "signature": "0IBSGr_qQqrI_xomMDz__I5j1_FcuprNpJ4VSmcTyMqctsru4cJ0Oy3VDoZfCLTVzvGrYR70SWLuy8K8zB1d7LFl"
}
```

### Linking

this is a link container, it is generated by the new device

```json
{
  "payload": {
    "identification": {
      "accountId": "EJ9QXk4u3-3ynQfXCtuQU7PYWGcXGPWtDAZpaQ90ub-Z",
      "deviceId": "ECJE3sGAJnwZsUxu46-zj_LQpxei2NEnh-ZQeppR-1X5"
    },
    "publicKeys": {
      "current": "1AAIAluYwXHiULm60e_nYzrEav0uW6g8sIMMtGW8zn23Q0dp",
      "nextDigest": "ECbKCe2YvxL7xU7m-iPswF_NauyTU0A9d7pxlFLsxYtC"
    }
  },
  "signature": "0IAFUe-P-rCy4isLES911Jz5fiK3LqKzSu9Nl-IQzZv1yQ5vHs3_9n_NHpVXrk73jtIQ-nQky7B-xjZCtxCOYTYX"
}
```

the container is embedded in the existing device:

request

```json
{
  "payload": {
    "access": {
      "nonce": "0AAOZeLKFZHfxS8nHllFLKvB"
    },
    "request": {
      "identification": {
        "accountId": "EJ9QXk4u3-3ynQfXCtuQU7PYWGcXGPWtDAZpaQ90ub-Z",
        "deviceId": "EBacAGXcp9vZ9zw99Bo2amFx-cdNJavdni5PWHYFs1Vk"
      },
      "link": {
        "payload": {
          "identification": {
            "accountId": "EJ9QXk4u3-3ynQfXCtuQU7PYWGcXGPWtDAZpaQ90ub-Z",
            "deviceId": "ECJE3sGAJnwZsUxu46-zj_LQpxei2NEnh-ZQeppR-1X5"
          },
          "publicKeys": {
            "current": "1AAIAluYwXHiULm60e_nYzrEav0uW6g8sIMMtGW8zn23Q0dp",
            "nextDigest": "ECbKCe2YvxL7xU7m-iPswF_NauyTU0A9d7pxlFLsxYtC"
          }
        },
        "signature": "0IAFUe-P-rCy4isLES911Jz5fiK3LqKzSu9Nl-IQzZv1yQ5vHs3_9n_NHpVXrk73jtIQ-nQky7B-xjZCtxCOYTYX"
      }
    }
  },
  "signature": "0IDJDNu06zAhnl0qlxHFLd63YOoYTCKmTFogtb12BtNJ8PTj5cSTBEvZxQ5FdL11JC4Q4kt1aMWosum4CW2uqwvZ"
}
```

response

```json
{
  "payload": {
    "access": {
      "nonce": "0AAOZeLKFZHfxS8nHllFLKvB",
      "responseKeyDigest": "EK_kpHO4B4WcU8bVEC_mcSHe6Gv4WF32yDybgp2aQFek"
    },
    "response": {}
  },
  "signature": "0IBPjjPKVBTuVWVWWepvDJmNKsqVIbToG7aV1GTwO428gaCLkGdhgOTuJF8ivMOtdW1axf4J4fmC08BOZEYy1qaA"
}
```

### Rotation

request

```json
{
  "payload": {
    "access": {
      "nonce": "0AAUPiRjtCz2i8GecHsd3nO0"
    },
    "request": {
      "identification": {
        "accountId": "EEfoXt-P0hkc9oeWcuDvLlhpKzrW6cOArxkWMh4dHoTF",
        "deviceId": "EFIedBknRKs-xVO6NkzluP_XdFw27PVmzCVKQ1rC2ahY"
      },
      "authentication": {
        "publicKeys": {
          "current": "1AAIA5QKyLZDv1KRbeTYtqwhzOGe-ufPGgA77l8VmyRHsQei",
          "nextDigest": "ELPUX5CFVjXf4PpnHDB5U16FRTDznHTsjSoe-oyKOGTb"
        }
      }
    }
  },
  "signature": "0ID7ex-cQmQPO3RsZE6wjpOxmHClB19MLoQwlKN77dTe2aRBGEJ4LSjZ7CUOjzzUWNcd07feBYnzI9E_JDGq6_is"
}
```

response

```json
{
  "payload": {
    "access": {
      "nonce": "0AAUPiRjtCz2i8GecHsd3nO0",
      "responseKeyDigest": "EBobmrjOgamcKwN8zNuWCKH66lRo01ifxP5e8ZswLwun"
    },
    "response": {}
  },
  "signature": "0IDt-sJ1s7UBmOqXKFVGW6JvVhKFOxnZi3pcg0wcDwJC_OJelow-F8upY2Flho9LESYLvY3jIu0VImyD5NFBFjOm"
}
```

### Authentication

request (request for challenge)

```json
{
  "payload": {
    "access": {
      "nonce": "0ACPh3dSpjXFjwV18ly6bmAD"
    },
    "request": {
      "identification": {
        "accountId": "EEfoXt-P0hkc9oeWcuDvLlhpKzrW6cOArxkWMh4dHoTF"
      }
    }
  }
}
```

response (challenge)

```json
{
  "payload": {
    "access": {
      "nonce": "0ACPh3dSpjXFjwV18ly6bmAD",
      "responseKeyDigest": "EBobmrjOgamcKwN8zNuWCKH66lRo01ifxP5e8ZswLwun"
    },
    "response": {
      "authentication": {
        "nonce": "0AC0GiJq51Wiq30lVp1b0iN-"
      }
    }
  },
  "signature": "0IC8yd431xraDOYuWoXzNeXd3gVvcxQL1PMfnWpTjWWqhKkFZULe0m14f3XsHLJ3sgEEHnGw4wYUZWGK-jOPIlq7"
}
```

request (response to challenge)

```json
{
  "payload": {
    "access": {
      "nonce": "0ACkumDg3GK0WoD_hifAzc4G"
    },
    "request": {
      "access": {
        "publicKeys": {
          "current": "1AAIA4dOi7gATuS6-KLoyIOqjcVxOsa462h6kGB3F1poymOy",
          "nextDigest": "EFvphOgW7miXmd59JMZJ1ouGJZiLJWNqazaOFJQPE3he"
        }
      },
      "authentication": {
        "nonce": "0AC0GiJq51Wiq30lVp1b0iN-"
      },
      "identification": {
        "deviceId": "EFIedBknRKs-xVO6NkzluP_XdFw27PVmzCVKQ1rC2ahY"
      }
    }
  },
  "signature": "0IAtvQxHdZ3LvREAA9fTB9hOHDpMbmBYvqdy53WFZFmqKuJsklpSXuHJdgcvFIbj5Hm2esp0anK2Kwmeax1Eq0Ep"
}
```

response (grant)

```json
{
  "payload": {
    "access": {
      "nonce": "0ACkumDg3GK0WoD_hifAzc4G",
      "responseKeyDigest": "EBobmrjOgamcKwN8zNuWCKH66lRo01ifxP5e8ZswLwun"
    },
    "response": {
      "access": {
        "token": "0IDWRxGJuUww8gw41ZaMIbCRyPkhQYavlvTIOelYaNQgOIFOJVdqvwpFRfmtMhgsdTOH-BO9VXiiivy6r_7VlFx4H4sIAAAAAAACA23Oy1LCMBQG4HfJ2jq9UWx3ZWiRAgaRsQyOi5AEEqFNyQVbGN7d4FI5yzP_959zAQhjYWo9JiABWbYVK-3MXbbHsaAlNsPT9MCayVmWEYapbPfljIXkWSxz8AAaszlwPKGdpV6ajtOQQN7fpUvzFjmTqejG8PiF31uoUBj5LNqPBkHuNaKrYGd5TVs95Duq9O10fmoY3JX9iq8q0ouL2brwhBkVaz4typcjOiOYF6_zLGDUWq6UoSS9Sd_1e44bO3649Nyk95S40WMcx-7vrG2Wtg2X3Z-kl3jBv6SkW0kVy-4A379XjbSWfGM0VSC5gIbKyj7GRa0G3UIc6G2JSMVrkHzYckQs-ZZcU_B5vV5_AHn3oc18AQAA"
      }
    }
  },
  "signature": "0ICDzboZALLPUfa3xEbS-y7_ZW0PlYVPOirC9Te_zQ7LRRgkGVT6frOMocw492C4viVnC8DkpBSuA_jFxWs1Bav4"
}
```

### Refresh

this rotates the access key

request

```json
{
  "payload": {
    "access": {
      "nonce": "0AALjbEENdPVx8jx2DrCFbgr"
    },
    "request": {
      "access": {
        "publicKeys": {
          "current": "1AAIAh3LLwXyZCb4TfOeWAGmWfjrEqZCak3tT8OZSsFceQNn",
          "nextDigest": "EN3HIZTV6tZ4PpbB27nUxFUUp2lUoC9Jv3GoiYdJfM30"
        },
        "token": "0IDWRxGJuUww8gw41ZaMIbCRyPkhQYavlvTIOelYaNQgOIFOJVdqvwpFRfmtMhgsdTOH-BO9VXiiivy6r_7VlFx4H4sIAAAAAAACA23Oy1LCMBQG4HfJ2jq9UWx3ZWiRAgaRsQyOi5AEEqFNyQVbGN7d4FI5yzP_959zAQhjYWo9JiABWbYVK-3MXbbHsaAlNsPT9MCayVmWEYapbPfljIXkWSxz8AAaszlwPKGdpV6ajtOQQN7fpUvzFjmTqejG8PiF31uoUBj5LNqPBkHuNaKrYGd5TVs95Duq9O10fmoY3JX9iq8q0ouL2brwhBkVaz4typcjOiOYF6_zLGDUWq6UoSS9Sd_1e44bO3649Nyk95S40WMcx-7vrG2Wtg2X3Z-kl3jBv6SkW0kVy-4A379XjbSWfGM0VSC5gIbKyj7GRa0G3UIc6G2JSMVrkHzYckQs-ZZcU_B5vV5_AHn3oc18AQAA"
      }
    }
  },
  "signature": "0IBmKmXoJlL0T_s15qHMctGlkQcHrj_7fNYo0AGB4qe2RfwOKOZf2sooS95NTXGIYpV5wPSnYfcrJil9F7wfu631"
}
```

response (new token)

```json
{
  "payload": {
    "access": {
      "nonce": "0AALjbEENdPVx8jx2DrCFbgr",
      "responseKeyDigest": "EBobmrjOgamcKwN8zNuWCKH66lRo01ifxP5e8ZswLwun"
    },
    "response": {
      "access": {
        "token": "0IB7plmv49QUVmbi7ZzQhGXs_U0426Qr_syya3fW5kNKZ8plcFwoyynSjOCrDNkuTV0O00LRR6e92sPiOaUVFNhsH4sIAAAAAAACA23OyVKDQBAG4HeZs0kNSxa4kYTsq4JELA8wNDKGMDgzJGAq7-4kF6vUPnb93999QREhrCrkLEE2ct2U7WVri7MDsRgEpBqdlnlWLr540CUbh9eHYJWZyZR5Y_SAyirOKVlAo6jmODMnM5bL874Jh7HppRsInMkxSD-4-xkOo4Mhvf4mfBJjArt1oXgBtRzRdxDydnptTGeh99yVobkt44HeK_x67PulnvtsaM1PxoTRl2SergysLBWigsS5SR3rnRa2Wrrpadju9G3ca2Ns4vuEKgt1SXnzK6nZmvEnySHlIDL3H6Dr9-pu27KsHxBJyWlcSRDIvqAS-FE9RlkhBs0jy-G2jJIjLZD9qsqjRJEzpxLQ2_V6_QbLHWWFfAEAAA"
      }
    }
  },
  "signature": "0ICFSTTENu3dLJpFzTJEV8GqzBXl6-Wp6OXLyR5p-Xoo26HwHksIrQ489IpNx2jgsjTQoszprUkpiJjecPQxfrb0"
}
```

### Access

request

```json
{
  "payload": {
    "access": {
      "nonce": "0ADTA2qeaAbaUQARIfwiz2wu",
      "timestamp": "2025-09-24T10:58:07.006000000Z"
    },
    "request": {
      "foo": "bar",
      "bar": "foo"
    },
    "token": "0IB7plmv49QUVmbi7ZzQhGXs_U0426Qr_syya3fW5kNKZ8plcFwoyynSjOCrDNkuTV0O00LRR6e92sPiOaUVFNhsH4sIAAAAAAACA23OyVKDQBAG4HeZs0kNSxa4kYTsq4JELA8wNDKGMDgzJGAq7-4kF6vUPnb93999QREhrCrkLEE2ct2U7WVri7MDsRgEpBqdlnlWLr540CUbh9eHYJWZyZR5Y_SAyirOKVlAo6jmODMnM5bL874Jh7HppRsInMkxSD-4-xkOo4Mhvf4mfBJjArt1oXgBtRzRdxDydnptTGeh99yVobkt44HeK_x67PulnvtsaM1PxoTRl2SergysLBWigsS5SR3rnRa2Wrrpadju9G3ca2Ns4vuEKgt1SXnzK6nZmvEnySHlIDL3H6Dr9-pu27KsHxBJyWlcSRDIvqAS-FE9RlkhBs0jy-G2jJIjLZD9qsqjRJEzpxLQ2_V6_QbLHWWFfAEAAA"
  },
  "signature": "0IB5zG_X4ymfS3hQjszy0B_bimatOJbhJN6XlJohFE4j8EQFHCmAok1Hb6Pv1X4KCuvUUVDGxl5-K9ScjjXNTxwh"
}
```

response

```json
{
  "payload": {
    "access": {
      "nonce": "0ADTA2qeaAbaUQARIfwiz2wu",
      "responseKeyDigest": "1AAIAieYt43I8BAWECBwnUm8VJAOQ5emaEXaC_1AehVLVLWF"
    },
    "response": {
      "wasFoo": "bar",
      "wasBar": "foo"
    }
  },
  "signature": "0IAJ0d4PCBpqCJ_4GgEGO8F7pRJsAWoXGWJCionvoqCeT-C8jgSuoKKHOTs7evCRDG1QMztUbAGojGMBCEXdSxQP"
}
```
