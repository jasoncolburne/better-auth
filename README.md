# better-auth

Examples given are encoded using CESR (Composable Event Streaming Representation) and ideas
surrounding forward secrecy came from KERI (Key Event Receipt Infrastructure)

The examples given were generated by the [reference typescript implementation](https://github.com/jasoncolburne/better-auth-ts)
which is a great place to learn more about how this works.

## Protocols

### Creation

generate an identity (identifier) on the client, this could be backed by something like KERI
but that isn't necessary.

request

```json
{
  "payload": {
    "access": {
      "nonce": "0ACYFfwTgpmCHjU16Hhbw3Kn"
    },
    "request": {
      "authentication": {
        "device": "EBjwDGOIYRyVZkPivYPgG2HNtIDJWyE_qg1Ni3KzgIoV",
        "identity": "EHw1tikrXyOFvs3VeJSQ6ISybjHQdtzeJ6Ao0QH78lne",
        "publicKey": "1AAIAp6BL6tDRnlCFOu2DeyjmqqRarhbXBMb5_YBpWMA5D1Z",
        "recoveryDigest": "EKoLUmRkSIv1uWfh7SFa1mEtuos1Qjx11aIgAQLg89oL",
        "rotationDigest": "EJz_n5xbuGDUMKUF8C7TBWB1AhR4QMNfjjYs91vmkl9V"
      }
    }
  },
  "signature": "0IC3J9bVPYEi0AtyUgWgItX7_BsJEQt9VaVSch75N1K7DsuTUFEFZW1Ri0QLfvH9hpG87Y7TV82-6B-_BnJ7Y7nO"
}
```

response

```json
{
  "payload": {
    "access": {
      "nonce": "0ACYFfwTgpmCHjU16Hhbw3Kn",
      "responseKeyDigest": "EOBuusICHW8lIVdFyuJwLzM72F8b5de8JAIgebFnvYfY"
    },
    "response": {}
  },
  "signature": "0ICz-mKrpPy4yOeAV6kBqxakqHbuLgEOVISsdcSgV8Sv3UG-jogwZdhwKFwsPP73dME2FheLPDMABPhpR6UNGXsb"
}
```

### Recovery

request

```json
{
  "payload": {
    "access": {
      "nonce": "0AAGYlGygvlzkZJ2rxxXHJnR"
    },
    "request": {
      "authentication": {
        "device": "EH9U45gDBu-3ge_yObeEfvTc3-EhoXaFGXMO09-XpI7_",
        "identity": "EBbkajOzeWnQ7hDEpix5s2qLN_-qMrlSm_VlLGBPQ1Ex",
        "publicKey": "1AAIAiH2VWe5TK07SR1fjPQl2Ecu309QgSA7k9gbc5WUTXUz",
        "recoveryKey": "1AAIA3stWiZuUQlTOWBjCjgM7qFLGAWReCiFX9dzK-ZRn-OU",
        "rotationDigest": "EBI3-0k43z3XJ7tdgnc-Ra2jnU-pqYBvdPyi1SDDNah7"
      }
    }
  },
  "signature": "0IBt-B4NDgyB5Bel1X4oJ0W-yrnkhBc8NVKdGP15eYS1Ijkpz4MTGqsLfAHi5M_DbqvLQgy_IOlDTqsJrsmHXxWV"
}
```

response

```json
{
  "payload": {
    "access": {
      "nonce": "0AAGYlGygvlzkZJ2rxxXHJnR",
      "responseKeyDigest": "EGhc5TlGMwrlI0syM1i2roiJm4SoFvSf3geKorNoRfaZ"
    },
    "response": {}
  },
  "signature": "0ICJk4xqke5obhMKVqy1ancpMjR58HTOTlaASgkLQv9UYSxdrKX0EkeBUBxOL0k9IX2xL1YaWjum8RLYX6Tqx4kG"
}
```

### Linking

this is a link container, it is generated by the new device

```json
{
  "payload": {
    "authentication": {
      "device": "EAeueCY2nUMvTVXoqhO_GoMWAQawf4RGiXKjYMwMUEUC",
      "identity": "EHEqLuYoquguyuvUu_dgTTVYEU3_vqLNYTjKKjsNmnud",
      "publicKey": "1AAIA_lsRwtG2q6IVHjfuwlaShdtMibue_yRjcunz8moAW3z",
      "rotationDigest": "EHrxLVwLvm8kKALIPeko0ilnqAFtZT8mu2UVxiRZMcww"
    }
  },
  "signature": "0IDTsZn4KCWN_isCuDPS-d6QLG0E9RjzbyBICYsnM8n_b2pR2GVxOKCpxu61CB9_hfGGop_E43WnejDmOBb9pp-U"
}
```

the container is embedded in the existing device:

request

```json
{
  "payload": {
    "access": {
      "nonce": "0AC3sYrFyNp7pCZk1Vj3KaQM"
    },
    "request": {
      "authentication": {
        "device": "EPfZ8zMf23_5Hd0rBmKy2Og5cMUvJMkVEY4rAoGATqhp",
        "identity": "EHEqLuYoquguyuvUu_dgTTVYEU3_vqLNYTjKKjsNmnud"
      },
      "link": {
        "payload": {
          "authentication": {
            "device": "EAeueCY2nUMvTVXoqhO_GoMWAQawf4RGiXKjYMwMUEUC",
            "identity": "EHEqLuYoquguyuvUu_dgTTVYEU3_vqLNYTjKKjsNmnud",
            "publicKey": "1AAIA_lsRwtG2q6IVHjfuwlaShdtMibue_yRjcunz8moAW3z",
            "rotationDigest": "EHrxLVwLvm8kKALIPeko0ilnqAFtZT8mu2UVxiRZMcww"
          }
        },
        "signature": "0IDTsZn4KCWN_isCuDPS-d6QLG0E9RjzbyBICYsnM8n_b2pR2GVxOKCpxu61CB9_hfGGop_E43WnejDmOBb9pp-U"
      }
    }
  },
  "signature": "0IDHQ9fbcyUk9aGTY5vhCN3i0rFFTmrasYwB3R6FA22yu8FG3XXZOpzi4dKb-jqXUFka7YolFEhqlOiYbF28eFDR"
}
```

response

```json
{
  "payload": {
    "access": {
      "nonce": "0AC3sYrFyNp7pCZk1Vj3KaQM",
      "responseKeyDigest": "EEu4dkOq2HYv0RHmPwZs2DYfiP_kZrxb6Os2dfy6P-rj"
    },
    "response": {}
  },
  "signature": "0ICuIyv7d2SnSXVktt2k-eSQ_sTOiGvfPE0N7McFrPEHD_6I_mB-4_F2cjnzMJGwizbsYaZoo8ixicl5it-sopYy"
}
```

### Rotation

request

```json
{
  "payload": {
    "access": {
      "nonce": "0ABMMMhKwrZ4wmFDujhlUG1K"
    },
    "request": {
      "authentication": {
        "device": "EBjwDGOIYRyVZkPivYPgG2HNtIDJWyE_qg1Ni3KzgIoV",
        "identity": "EHw1tikrXyOFvs3VeJSQ6ISybjHQdtzeJ6Ao0QH78lne",
        "publicKey": "1AAIAkU1x-TATpLu0Sxr-C3ttpM3TYXY51TS40eJCoddy59U",
        "rotationDigest": "EAenGSV28wgvWF4-YnuKZr-lpQuU1X2UoC3YpOo3x9Mt"
      }
    }
  },
  "signature": "0IDGOoHW_iiKPGTE_yHXLgWvDSo8Q72y8euPWzV9b_97Q4I0lqX4AsT1bVkzl83CADO_ViWdlJMGcGhQkyvORNmb"
}
```

response

```json
{
  "payload": {
    "access": {
      "nonce": "0ABMMMhKwrZ4wmFDujhlUG1K",
      "responseKeyDigest": "EOBuusICHW8lIVdFyuJwLzM72F8b5de8JAIgebFnvYfY"
    },
    "response": {}
  },
  "signature": "0ICYOD7DPVa0dE77sach31-1vacBHYsBC4urcGPLoKTAqqyO7wU1aY_BrPqCM6czDrTC3wglkn_lT4tjztNSTK5V"
}
```

### Authentication

request (request for challenge)

```json
{
  "payload": {
    "access": {
      "nonce": "0AB2WkZz39810y35I7TgLDUi"
    },
    "request": {
      "authentication": {
        "identity": "EHw1tikrXyOFvs3VeJSQ6ISybjHQdtzeJ6Ao0QH78lne"
      }
    }
  }
}
```

response (challenge)

```json
{
  "payload": {
    "access": {
      "nonce": "0AB2WkZz39810y35I7TgLDUi",
      "responseKeyDigest": "EOBuusICHW8lIVdFyuJwLzM72F8b5de8JAIgebFnvYfY"
    },
    "response": {
      "authentication": {
        "nonce": "0ACn42gUxCnjKNkT4vpf9Y84"
      }
    }
  },
  "signature": "0IDkT3gFmpxFqZsS-OzK60H4-Dkgxr9yGbOQiqJ35gtoHdzH-V62wxADIgUcSM7PYj5syfgKLzDBJMEDZQBwFadI"
}
```

request (response to challenge)

```json
{
  "payload": {
    "access": {
      "nonce": "0ADAsKJOF7fsVdkGfByM_Zze"
    },
    "request": {
      "access": {
        "publicKey": "1AAIAmHAwLvzWWZw1_G2FuA4SQSgvB9DrN88wS0oq2N22icE",
        "rotationDigest": "EGQ39BAHjNh2IWpWd5B0wNxZ5d699JxiXLcsdWelNN4h"
      },
      "authentication": {
        "device": "EBjwDGOIYRyVZkPivYPgG2HNtIDJWyE_qg1Ni3KzgIoV",
        "nonce": "0ACn42gUxCnjKNkT4vpf9Y84"
      }
    }
  },
  "signature": "0IBDwkpanqgriqzCx68_RKDF0fEXUDY2GOq6zSi6HLWSjQA1hXdfVuX5aIGK26-A5F1tMgsZgqSCKT7L32THIy1R"
}
```

response (grant)

```json
{
  "payload": {
    "access": {
      "nonce": "0ADAsKJOF7fsVdkGfByM_Zze",
      "responseKeyDigest": "EOBuusICHW8lIVdFyuJwLzM72F8b5de8JAIgebFnvYfY"
    },
    "response": {
      "access": {
        "token": "0IDiVvrqJJad2p-HU9oFINdO3arCFC3JRZ8ODPTpu91o6mrucxxluJ15NOFP7-MyyZsHtbXd251h6XLEKjCVRNNuH4sIAAAAAAACA22PXW-CMBSG_0uv51KqIHBX4gc4w8IwYlyWBemZ1iGwtnxp-O-r2aU7lyfP857z3lCaZWVdqIAhF8391lD8W-z610Ujx1tYxZEVxP3h7EdMXWFl0RJH_tTOC0BPqKoPOc9eoNeqQWlALz5t1801Sfat8bkki5pO4ig-Np4zE6FttzEuf0hICM_mWhelShUvixk_glT388to7HjUP4cnEiRVwkwPt2G3N5nlOKuO79aZZAnkYTg5aZ9LWQOjd5NgYo6wMyKTDTFcbLsEP1tT_Dd7zUJXcdE_kGT8QAr4EiBP8wfB3GDnv-hUKcEPtQKJ3BuqQFz0Y7qW9Pq3Mof7MmUXXiD3XYenTCut4ArQxzAMvzbSqryAAQAA"
      }
    }
  },
  "signature": "0IB6KTQCHHkSyEAuDg92audwSyTmP_pJs3U_Xwnf7I3XLARRJnFpmfgMKlP568K3lvEdGzLzgeuwnWXiCFI6wI20"
}
```

### Refresh

this rotates the access key

request

```json
{
  "payload": {
    "access": {
      "nonce": "0ADdtBjPLNxoxUXl3wA371OA"
    },
    "request": {
      "access": {
        "publicKey": "1AAIAuyPf-BzR4VH6gScDiajAt9GTdJfs5peBPDZgYVoOFn3",
        "rotationDigest": "EISwRhkMftm97AHtQoiIx-YeqUOCPTqclIVnaPs9Hng1",
        "token": "0IDiVvrqJJad2p-HU9oFINdO3arCFC3JRZ8ODPTpu91o6mrucxxluJ15NOFP7-MyyZsHtbXd251h6XLEKjCVRNNuH4sIAAAAAAACA22PXW-CMBSG_0uv51KqIHBX4gc4w8IwYlyWBemZ1iGwtnxp-O-r2aU7lyfP857z3lCaZWVdqIAhF8391lD8W-z610Ujx1tYxZEVxP3h7EdMXWFl0RJH_tTOC0BPqKoPOc9eoNeqQWlALz5t1801Sfat8bkki5pO4ig-Np4zE6FttzEuf0hICM_mWhelShUvixk_glT388to7HjUP4cnEiRVwkwPt2G3N5nlOKuO79aZZAnkYTg5aZ9LWQOjd5NgYo6wMyKTDTFcbLsEP1tT_Dd7zUJXcdE_kGT8QAr4EiBP8wfB3GDnv-hUKcEPtQKJ3BuqQFz0Y7qW9Pq3Mof7MmUXXiD3XYenTCut4ArQxzAMvzbSqryAAQAA"
      }
    }
  },
  "signature": "0IDvTnx0O4SAftz9snjGj8SgkqJnpMpL0Z7O3gEqiXK0fVxfowcCVTNE981TX0PNxVMpFTngRWIywDgz0rbPMiJL"
}
```

response (new token)

```json
{
  "payload": {
    "access": {
      "nonce": "0ADdtBjPLNxoxUXl3wA371OA",
      "responseKeyDigest": "EOBuusICHW8lIVdFyuJwLzM72F8b5de8JAIgebFnvYfY"
    },
    "response": {
      "access": {
        "token": "0ICMMFfVM3towSP76UCAgrXHkAXvlX7psCLf4hZRWTP6gsWRoV1Ag075KsSdfKc5vsNEz3eKYtorY2fHLcPL8IQzH4sIAAAAAAACA2XPTXOCMBAG4P-Sc-kEFBRusWrBTkcQylQ7PURYMIoBk1BFx_9u7KE9uMed99mPC6JZVrdcBTny0MQ_mortxGc3n_7IXgqzOHKCuFtv_ShXZ5g5pMaRPxhWHNATatp1xbI36DQ1CQlI24WFMTov-qnvlHE2ZnRLlPua5LNC2g2MwvGqXKb1fMp7motaUcVqPmYlSHVfH8THxWb3Xqi9OyC-imoWnIwlHD7mL2FyyKog5TSUrs9LU3smZQs5uUsLW7aBXcPqJ5bp4aFn4WdnYOPfWuksnBomuoek1XtICigEyM3kAdgJdv9G439AlRJs3SqQyLugBsReH6bfkqNuUVdwb9J8zzjyvvRwmmtyFEwB-r5erzflNtxogAEAAA"
      }
    }
  },
  "signature": "0IDvQ0vrfkRpDVzGU32_jmHRW0ceL3Dl3FWMOAWfDy4JiQwUEkhOFrqCMLz22FXWz_aIHMIBP5ocFkcwVtIZHmZG"
}
```

### Access

request

```json
{
  "payload": {
    "access": {
      "nonce": "0ADnHXWgyTYFrVSylU9ySsfT",
      "timestamp": "2025-09-24T21:08:20.676000000Z",
      "token": "0ICMMFfVM3towSP76UCAgrXHkAXvlX7psCLf4hZRWTP6gsWRoV1Ag075KsSdfKc5vsNEz3eKYtorY2fHLcPL8IQzH4sIAAAAAAACA2XPTXOCMBAG4P-Sc-kEFBRusWrBTkcQylQ7PURYMIoBk1BFx_9u7KE9uMed99mPC6JZVrdcBTny0MQ_mortxGc3n_7IXgqzOHKCuFtv_ShXZ5g5pMaRPxhWHNATatp1xbI36DQ1CQlI24WFMTov-qnvlHE2ZnRLlPua5LNC2g2MwvGqXKb1fMp7motaUcVqPmYlSHVfH8THxWb3Xqi9OyC-imoWnIwlHD7mL2FyyKog5TSUrs9LU3smZQs5uUsLW7aBXcPqJ5bp4aFn4WdnYOPfWuksnBomuoek1XtICigEyM3kAdgJdv9G439AlRJs3SqQyLugBsReH6bfkqNuUVdwb9J8zzjyvvRwmmtyFEwB-r5erzflNtxogAEAAA"
    },
    "request": {
      "foo": "bar",
      "bar": "foo"
    }
  },
  "signature": "0IDQe3qjimcRmUiIMIHs3godBAbFjGWGTdc4b5YhVFbDnmKyCOojVyryUOWSq7cjL-llEY43ziCAdsvruRaAakco"
}
```

response

```json
{
  "payload": {
    "access": {
      "nonce": "0ADnHXWgyTYFrVSylU9ySsfT",
      "responseKeyDigest": "1AAIApAouXMf8OqeshMaI3tM52ipo5YJ0Vq-Nu8zPF1NpS5m"
    },
    "response": {
      "wasFoo": "bar",
      "wasBar": "foo"
    }
  },
  "signature": "0IBF3Uqb8oqRqVDf5qcn4BBD4BQYdgO4zO4IjaP9F0AObE54YsycJqAtctFeYH1Qj-fGNN1XnynnDkxhHVZO2m35"
}
```
