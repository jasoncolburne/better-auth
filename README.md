# better-auth

Examples given are encoded using CESR (Composable Event Streaming Representation) and ideas
surrounding forward secrecy came from KERI (Key Event Receipt Infrastructure)

The examples given were generated by the [reference typescript implementation](https://github.com/jasoncolburne/better-auth-ts)
which is a great place to learn more about how this works.

## Protocols

### Creation

generate an identity (identifier) on the client, this could be backed by something like KERI
but that isn't necessary.

request

```json
{
  "payload": {
    "access": {
      "nonce": "0ACpzCJ1_cO1mS3Db9hIlHH_"
    },
    "request": {
      "authentication": {
        "device": "EHRdukAuiP9uZZfO_CzaV37H7mRfnjr3_RYLmrTZ4flR",
        "identity": "EEJ4WgnwYkdjcsTx68sjtY3Hp7uljZkYkQumNISzckkQ",
        "publicKey": "1AAIAhvX_9ukbbr-lRVjSKO4Xn8OrOsnnsqAWUXdDP_WQNH-",
        "recoveryDigest": "EOfzvF4fU0gHX9FR4qE8VlbaKSC-qCnoWPEFkBkgkGyb",
        "rotationDigest": "EIrvt69hJc3LaI1NoxrlbSuUgt5CyoZzdHCKLtYmAsCG"
      }
    }
  },
  "signature": "0IAbXo4OVuB0c0DRb5DAc7IfBoXA3XmaXDkrkL8MKTLUkA4mWOH5Nf8XOU7N6RmQSkFBwEMGO84clVD7Kfxt69VM"
}
```

response

```json
{
  "payload": {
    "access": {
      "nonce": "0ACpzCJ1_cO1mS3Db9hIlHH_",
      "responseKeyDigest": "ELkhVNm7joIDGdsnqNrmRdcafnpXJ_zpkirGImcJ0hAC"
    },
    "response": {}
  },
  "signature": "0IDMxxFQ5RtTUoMFz83oHXT9rnzw1MK9agmEEnZkCYVSf23pWUEYN4dI5X3Lgewm_5Gq_PcViG-KLikJpiROoWYb"
}
```

### Recovery

request

```json
{
  "payload": {
    "access": {
      "nonce": "0AB3P4L3-zZHpVCO2qMaxdGG"
    },
    "request": {
      "authentication": {
        "identity": "EDR0LbLanrcs11gOG1qX3fgIxVMUbPHStKH3gPa64gjc",
        "device": "EAHZVZmEjEjtIhBjgTkQLZHiFIT2qrvb9hzfgLQU_hTn",
        "publicKey": "1AAIAghDNwF4o1zo3YHoNCgkdBE4PVonM9_fwK92HwhpvKi8",
        "recoveryKey": "1AAIAh3IVjmhCWczCIDEyuL7DFzK_51HE704pxSzgnWyqhbd",
        "rotationDigest": "EHhM6mnRjApYidn5vHU3jouy0g-4i04AFeqNUpX1eWRc"
      }
    }
  },
  "signature": "0IAWGCiq7WMeahToRhXzR1miDWrJ7RB6MW2Jcs6qUbG6RHJ3-UpNZrUMrxeMIy_NNfC7iF8YpOjVTQFo627dHjgv"
}
```

response

```json
{
  "payload": {
    "access": {
      "nonce": "0AB3P4L3-zZHpVCO2qMaxdGG",
      "responseKeyDigest": "EI-BpReGXuKzUT_cD6H1e6zVBsC1Sj7JfgsvGukBfvXA"
    },
    "response": {}
  },
  "signature": "0IDJgohYZ_8lZ34YuwtZpIcsecqvbBGdfzanooelrGGhd99cxPzxDSeskVMW3T6ni2FL9IX4UskQNRQioIXcc6-8"
}
```

### Linking

this is a link container, it is generated by the new device

```json
{
  "payload": {
    "authentication": {
      "device": "EF9WXWh1-5ITsG30xyPH1MU-2Qg5aS0M6KVACQ5DxE2w",
      "identity": "EK-oSNcUYFVCz3FuUNDp8kvD88mjJ49CFXHKz749Q0yy",
      "publicKey": "1AAIAt6H0Bv37OvnqOPm_Gq8TE_aBjNjT7OQXwKLRNU5H20u",
      "rotationDigest": "EMeTB3x6s3NUvZOCUPfWeJsUOieOKTkSEq6GAqRjm9g3"
    }
  },
  "signature": "0ICwxfmTbBgSD8Y7InFwpe_FF4dV5kxBL9d4pIIlPB2XImSEUTNZNsAqpci-wJ-MLbcnlECmFhN5z-Z2NG-ZYwVl"
}
```

the container is embedded in the existing device:

request

```json
{
  "payload": {
    "access": {
      "nonce": "0AApUVkfYzCqgW6ciRA4rSZw"
    },
    "request": {
      "authentication": {
        "device": "EDPxYlTQN38TFojfOLu29lxbwp0DO3I9jzmOuqvEmpTo",
        "identity": "EK-oSNcUYFVCz3FuUNDp8kvD88mjJ49CFXHKz749Q0yy"
      },
      "link": {
        "payload": {
          "authentication": {
            "device": "EF9WXWh1-5ITsG30xyPH1MU-2Qg5aS0M6KVACQ5DxE2w",
            "identity": "EK-oSNcUYFVCz3FuUNDp8kvD88mjJ49CFXHKz749Q0yy",
            "publicKey": "1AAIAt6H0Bv37OvnqOPm_Gq8TE_aBjNjT7OQXwKLRNU5H20u",
            "rotationDigest": "EMeTB3x6s3NUvZOCUPfWeJsUOieOKTkSEq6GAqRjm9g3"
          }
        },
        "signature": "0ICwxfmTbBgSD8Y7InFwpe_FF4dV5kxBL9d4pIIlPB2XImSEUTNZNsAqpci-wJ-MLbcnlECmFhN5z-Z2NG-ZYwVl"
      }
    }
  },
  "signature": "0IAc6NN5sRV3TftbdC7P3FW_k4QJMkd_TJq8pEj46a83gUPZpoD0BD0D6-cs9xwinpCobjKaF5BFPGqKKMfLciwC"
}
```

response

```json
{
  "payload": {
    "access": {
      "nonce": "0AApUVkfYzCqgW6ciRA4rSZw",
      "responseKeyDigest": "EKeTqlHZj__r7EueHpCtDek8gY7YdSLsgcoXCU46-CKn"
    },
    "response": {}
  },
  "signature": "0ICdtiOj3Y9k9-veBQI5fgT2Vj5XlBzQTKzMaAo0EpA7gr26ajAQwTjR8ziYf1zcKxxKQDByRQfBj78h7jHY0jMX"
}
```

### Rotation

request

```json
{
  "payload": {
    "access": {
      "nonce": "0AAOJ-2E5TwNQ-djecdtCrjg"
    },
    "request": {
      "authentication": {
        "device": "EHRdukAuiP9uZZfO_CzaV37H7mRfnjr3_RYLmrTZ4flR",
        "identity": "EEJ4WgnwYkdjcsTx68sjtY3Hp7uljZkYkQumNISzckkQ",
        "publicKey": "1AAIA6H2KKgaQhvFjQhZBIHfMIGzps2zfqkm_x8O9GI_N3z5",
        "rotationDigest": "EHtXzwa-Zz_E25Py9alDMrT1zcwHCAVWTSgbRF79YAFl"
      }
    }
  },
  "signature": "0IBXwd_fLdEpjmX1WSbmNer1glyd08Xh2Mot_hnp1I77T5YmA7-2HjFboROHfdqqJ6tCLcaoQnbXO3yTMLXqSaE0"
}
```

response

```json
{
  "payload": {
    "access": {
      "nonce": "0AAOJ-2E5TwNQ-djecdtCrjg",
      "responseKeyDigest": "ELkhVNm7joIDGdsnqNrmRdcafnpXJ_zpkirGImcJ0hAC"
    },
    "response": {}
  },
  "signature": "0ICtYoXZxYNYyii2z6uWHpN0kpfU73AtepHtjN_pXbc5JrxIRX2gyHzuxbfpL8Vrs73HMknB5Qv-Q-rXF7RxciSx"
}
```

### Authentication

request (request for challenge)

```json
{
  "payload": {
    "access": {
      "nonce": "0ABs3Zlp0MoYzNmfFho7_rsI"
    },
    "request": {
      "authentication": {
        "identity": "EEJ4WgnwYkdjcsTx68sjtY3Hp7uljZkYkQumNISzckkQ"
      }
    }
  }
}
```

response (challenge)

```json
{
  "payload": {
    "access": {
      "nonce": "0ABs3Zlp0MoYzNmfFho7_rsI",
      "responseKeyDigest": "ELkhVNm7joIDGdsnqNrmRdcafnpXJ_zpkirGImcJ0hAC"
    },
    "response": {
      "authentication": {
        "nonce": "0ADVbLKxPT3XhCofqtdIjUjR"
      }
    }
  },
  "signature": "0ID94_VDouQ7Yv5QgAh-sjO44ixf2TXssVqwk5VYu39tPhdwnAkzrmTDo6wArkCo0hssaIKpbZ0v-NUGPkXCmjii"
}
```

request (response to challenge)

```json
{
  "payload": {
    "access": {
      "nonce": "0AAeW6Fc_IQ3WPTHWLDdWowW"
    },
    "request": {
      "access": {
        "publicKey": "1AAIA0BsDSoINTPhB5iU2OK1hSs7Gq421_ixA5ydtFu3iq4H",
        "rotationDigest": "ELBxVGCIfeYIvH4a-r2zqkVuZNGxfeYsSwX9X2QqRk23"
      },
      "authentication": {
        "device": "EHRdukAuiP9uZZfO_CzaV37H7mRfnjr3_RYLmrTZ4flR",
        "nonce": "0ADVbLKxPT3XhCofqtdIjUjR"
      }
    }
  },
  "signature": "0IC3OO6_6gaYJ3S3GfigIsa6lr_71AC8ZaCPsqc7pkZh8G-Iz9sdxZFDTP-Od4xW6mGSBzMejKGW7z2VcJsf58Jh"
}
```

response (grant)

```json
{
  "payload": {
    "access": {
      "nonce": "0AAeW6Fc_IQ3WPTHWLDdWowW",
      "responseKeyDigest": "ELkhVNm7joIDGdsnqNrmRdcafnpXJ_zpkirGImcJ0hAC"
    },
    "response": {
      "access": {
        "token": "0IDs5V01TZbCCu75NI4lajBrh4BWXFzN2ZxjvaMZDqFbQa0VveRkGYpxMORjyQiNwHegWszGGyjRvGAO6j06hLE_H4sIAAAAAAACA22PXVOCQBSG_8teZ7MsSyh3kKRkYylkQtM0CKuuq3zsh4KO_72ly-xcvvM87znnAtIsK1Uhgxw4wPef8cemOMUs32Uiah76Yidjc1zZar9LWMxm6jANwnPG2AzcgUqt9jSbkFarhusGLvTEMCyDafS29Sz6jl4nxjYU9qjGyPimjWu1uXxSJq3xWOu8lKmkZTGkGyJkt_7Faxajx2BN4uA4xmmPo3PNFiqZjhqdifC0HCzRrJ4zZGqfCqFI7nYmgsjqwUEP4QhBBw8cq39v2Sb8nUSzpKkob_-QhgPxDcnJmhOx9W8EK4L9_6pTKTldKUkEcC6gIvygD9NvCa-dl3vShWl-oAVwPnV5mmvlxKkk4Ot6vf4AXb0Ff4ABAAA"
      }
    }
  },
  "signature": "0IC9V6u0AC_ffVwnFTz9inEFOKje9p7UD7dBX7GZiJ_obeCPYmiu0r-Xs4E2t8SleaCQf-Xa1VsOmwM0pn9MvU7A"
}
```

### Refresh

this rotates the access key

request

```json
{
  "payload": {
    "access": {
      "nonce": "0AC27BzJOHCRyegdklZsVtHv"
    },
    "request": {
      "access": {
        "publicKey": "1AAIAr0YlPnEXiyzvhq9Uus8X4fwkcyJ73DwxHpEXZ0Y5vKE",
        "rotationDigest": "EDDejbvBqzjZDw1Fy4YhdGdtj55RAMKOMLlM_pc5YU4o",
        "token": "0IDs5V01TZbCCu75NI4lajBrh4BWXFzN2ZxjvaMZDqFbQa0VveRkGYpxMORjyQiNwHegWszGGyjRvGAO6j06hLE_H4sIAAAAAAACA22PXVOCQBSG_8teZ7MsSyh3kKRkYylkQtM0CKuuq3zsh4KO_72ly-xcvvM87znnAtIsK1Uhgxw4wPef8cemOMUs32Uiah76Yidjc1zZar9LWMxm6jANwnPG2AzcgUqt9jSbkFarhusGLvTEMCyDafS29Sz6jl4nxjYU9qjGyPimjWu1uXxSJq3xWOu8lKmkZTGkGyJkt_7Faxajx2BN4uA4xmmPo3PNFiqZjhqdifC0HCzRrJ4zZGqfCqFI7nYmgsjqwUEP4QhBBw8cq39v2Sb8nUSzpKkob_-QhgPxDcnJmhOx9W8EK4L9_6pTKTldKUkEcC6gIvygD9NvCa-dl3vShWl-oAVwPnV5mmvlxKkk4Ot6vf4AXb0Ff4ABAAA"
      }
    }
  },
  "signature": "0IDpQmY_nkrdmOyanFefXkTMrCf8xEgjwwMFtr2vMw8VUyXDROxR9YYAHa9dzJdQW2HEgKa6wUINCmp4R8SQZ3gY"
}
```

response (new token)

```json
{
  "payload": {
    "access": {
      "nonce": "0AC27BzJOHCRyegdklZsVtHv",
      "responseKeyDigest": "ELkhVNm7joIDGdsnqNrmRdcafnpXJ_zpkirGImcJ0hAC"
    },
    "response": {
      "access": {
        "token": "0ICMJskU63gaJgoTHVkHse6qdpFfCI2l7ISq1rKs6ZvLl0bw3Vj9zUJSLDppKn4epLJ_aremnPGR1gZVme7E-5YPH4sIAAAAAAACA2XPW0_CMBQH8O_SZzFltG7sbWRTLqJyi3TGmNEW6Da20QtjEL67xQdN5Dye_H_ncgYJpaUp9IABH0TREL1vippkLKVqfnzwVKpJp1-5Jk_jjGQTs3sZzE40yybgDlRmlQs64o2l7SAYBBKS_K2IlqI5Hbb77sIob4nWdUabodsJ62O_ipYxJPgwiiyXpU60KItQbLjS1_VhyNPVobc_pXFYtx8bRLbsiekU42kwHr2On_PxV0UxWaDSeqGU4Sy4Sgc6uAW7LQfNHeijro-9e-y68Kdim-XHSsjmX7LtQ3STlHwtudpGNwDPofc7uvMHEq2lWBnNFfDPoOJyZw-zb6leMy1zfm0mbCcK4H_Y4QmzpJZCc_B5uVy-ARwRzW-AAQAA"
      }
    }
  },
  "signature": "0IDJPDQMrUZLai41JibWf0VAJYn6Qfs1vNWlKylGuHb9fDcs0mcjgAROY3Msud91raS5_XBgbqYWcXXbXmC-ekRl"
}
```

### Access

request

```json
{
  "payload": {
    "access": {
      "nonce": "0ADScDTSG75BZwVoz2JCFvBT",
      "timestamp": "2025-09-24T20:49:58.579000000Z",
      "token": "0ICMJskU63gaJgoTHVkHse6qdpFfCI2l7ISq1rKs6ZvLl0bw3Vj9zUJSLDppKn4epLJ_aremnPGR1gZVme7E-5YPH4sIAAAAAAACA2XPW0_CMBQH8O_SZzFltG7sbWRTLqJyi3TGmNEW6Da20QtjEL67xQdN5Dye_H_ncgYJpaUp9IABH0TREL1vippkLKVqfnzwVKpJp1-5Jk_jjGQTs3sZzE40yybgDlRmlQs64o2l7SAYBBKS_K2IlqI5Hbb77sIob4nWdUabodsJ62O_ipYxJPgwiiyXpU60KItQbLjS1_VhyNPVobc_pXFYtx8bRLbsiekU42kwHr2On_PxV0UxWaDSeqGU4Sy4Sgc6uAW7LQfNHeijro-9e-y68Kdim-XHSsjmX7LtQ3STlHwtudpGNwDPofc7uvMHEq2lWBnNFfDPoOJyZw-zb6leMy1zfm0mbCcK4H_Y4QmzpJZCc_B5uVy-ARwRzW-AAQAA"
    },
    "request": {
      "foo": "bar",
      "bar": "foo"
    }
  },
  "signature": "0IDxBccdoFd0U3S1ZA6um6ugchSBLlDoZVuSEOoboFWF1WSa0lQLDBFr4SkItNUzPXc-0w2jaW57d2gY7lUIGLBV"
}
```

response

```json
{
  "payload": {
    "access": {
      "nonce": "0ADScDTSG75BZwVoz2JCFvBT",
      "responseKeyDigest": "1AAIA8ZapqzPhCDZKU-hRfYZAIxjcZe1izL0wkJqruZqcroH"
    },
    "response": {
      "wasFoo": "bar",
      "wasBar": "foo"
    }
  },
  "signature": "0IC6wveeWgJX5FtMGE0Q6FMmb4sdrGuykp2cExjRbaOrrSpkfAa3Tm9dWtlANLV0XBGnVYQHtfJDBLh9FVrxjmKS"
}
```
