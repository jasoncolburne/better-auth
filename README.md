# better-auth

Better Auth is a pluggable authentication protocol, agnostic to platform, encoding, cryptographic
and storage choices. Designed to be accessible, flexible and secure.

Examples given are encoded using CESR (Composable Event Streaming Representation) and ideas
about forward secrecy came from KERI (Key Event Receipt Infrastructure).

The examples were generated by the
[reference typescript implementation](https://github.com/jasoncolburne/better-auth-ts)
which is a great place to learn more about how this works.

## Design Principles

1. All actions except authentication to acquire an access session are gated by a rotation operation.
2. All requests contain a nonce to challenge the server.
3. Authentication is a two phase operation that involves the server challenging the client.
4. Rotations are protected using forward secrecy.

This has yet to be formally reviewed, and the claude implementations have barely been reviewed by
me. I got them working and plan to come back for polish.

Client implementations:
- [typescript](https://github.com/jasoncolburne/better-auth-ts)
- [dart (claude)](https://github.com/jasoncolburne/better-auth-dart)
- [kotlin (claude)](https://github.com/jasoncolburne/better-auth-kt)
- [python (claude)](https://github.com/jasoncolburne/better-auth-py)
- [rust (claude)](https://github.com/jasoncolburne/better-auth-rs)
- [swift (claude)](https://github.com/jasoncolburne/better-auth-swift)

Server implementations:
- [typescript](https://github.com/jasoncolburne/better-auth-ts)
- [golang](https://github.com/jasoncolburne/better-auth-go)
- [python (claude)](https://github.com/jasoncolburne/better-auth-py)
- [ruby (claude)](https://github.com/jasoncolburne/better-auth-rb)
- [rust (claude)](https://github.com/jasoncolburne/better-auth-rs)

## Protocols

In each protocol request or response payload one will find some data contexts:

- `access`: This will contain information relevant to the request and response pair.
- `request`: This is the request.
- `response`: This is the response.

The request and response contexts are broken down further into more contexts:

- `access`: This will contain information that permits access by the current device.
- `authentication`: This context will contain information that permits authentication of the current
device.
- `link` This contains information about another device. If necessary, this is broken into
contexts as well (when creating a link, the link context contains a payload and signature from
the device being linked).

There are 3 groups of protocols. `Account`, `Device` and `Session`.

Additionally, there is an `Access` request protocol that supports arbitrary request/response
payloads.

### Account

#### CreateAccount

To start, we need a recovery public key as an input. Then, we use a client interface to generate
two more keypairs and an identity. One key pair to reveal immediately and use for authentication,
and the other to reveal in the future when rotating. The identity derivation is up to the
implementer, but could conceivably go as far as a DKMS like KERI. The verification of this identity
is performed in another server side interface, before returning a response.

`device` is simply a hash digest of the `publicKey` and `rotationHash`, and the protocol handles
this transformation and verification.

`request`

```json
{
  "payload": {
    "access": {
      "nonce": "0ABic13dCJIYixhIS8fd6kfC"
    },
    "request": {
      "authentication": {
        "device": "EOnMhfF6CIKCvXrZkRxwPMBRy6MwgwSBM0H6hb1uDezu",
        "identity": "EDuDnuc2x21LfxlPQvvKSQoaOqOCMpoi4bbuX7DlsIEg",
        "publicKey": "1AAIAkZeridwme6y4GpivAoI9sw5LNyj9BJD5USSAJu165AD",
        "recoveryHash": "EBjQipjCHv-6_Gfr5SlMHsAajVJehBlgbqKz48wepiDI",
        "rotationHash": "EExjdqXJ8YEur1h_28-0SANF1dRnw3MpeCRZI--oR8Ou"
      }
    }
  },
  "signature": "0ID6mIMIBB9CGGygwW8rkAow4J7BgDKALJ-v2A86EmeicR7P304fcLEfRNcu_XI0oCmS-lSDUlFyKFzy9WY29EEY"
}
```

The server interfaces should check for uniqueness of `identity` and ensure it does not exist, which
is important because the client controls creation. Using the established methods, `device` and
`identity` should be verified. The `recoveryHash` should next be registered in storage with a
lookup key of `identity`. Finally the `publicKey` and `rotationHash` should be stored against a key
that looks like `(identity, device)`. This ordering ensures an account is never available for
authentication until a `recoveryHash` has been established.

`response`

```json
{
  "payload": {
    "access": {
      "nonce": "0ABic13dCJIYixhIS8fd6kfC",
      "serverIdentity": "1AAIA3gwJej58j_uVqUln-CjkaRihnQophMChhFNq_6bBvRE"
    },
    "response": {}
  },
  "signature": "0IDfojvyFkTvGumK2bfzcb7Lv3NcXfo1DFn2yqpE8pXyOjXK9XT5zq6J0lUX5nRDnIjJt0Hg-E7I7VI4SiAzXWJI"
}
```

#### DeleteAccount

Delete account removes the record of the account on the server, and also removes associated devices.

`request`

```json
{
  "payload": {
    "access": {
      "nonce": "0AA29lw2GfElc_vN2nZBY-KO"
    },
    "request": {
      "authentication": {
        "device": "EHjNZBQHfL46WumdUPr1MMSSdX2f1s8FRHy_wvax1p0X",
        "identity": "EFPS0fUY7gHy-R4N9yfzfdqZKQnSOl15hutYJVuVqUzn",
        "publicKey": "1AAIA1WNz7MEhI1G1cEkG5cWbtIqCub6v0ip06ZLflKpcto5",
        "rotationHash": "EDj7jwdHxVDMSg2JcPTZzg_f_tNWbvH9uDcZhYwXacM2"
      }
    }
  },
  "signature": "0IAx6sp9SPN4IRPm-oEmRewPN6XAeDP0gYk0WkvPXmdfB2xDwtKvSaAuaiXBawLJ1QjPWzUf-zs0AUGWeGgrbYUH"
}
```

`response`

```json
{
  "payload": {
    "access": {
      "nonce": "0AA29lw2GfElc_vN2nZBY-KO",
      "serverIdentity": "1AAIA1g5v_ZwgpR8jaQrti05grWVKCccnANyOz156q9-mr-L"
    },
    "response": {}
  },
  "signature": "0IAs58qlfNIV8hQIMR8DKs9PFTo90cDnirnvD_03RQQtAH7mJi3tFzcSo2DVj7oroPo4FnT-DRKu_dytd2bJ5sF7"
}
```

#### RecoverAccount

We registered a `recoveryHash` on account creation. Here, we pass the `recoveryKey` to the server
and sign with it, sending details to establish a new device against an existing identity in the
backend. It also revokes access to all existing devices. We establish a new recovery key when we use
the existing one.

`request`

```json
{
  "payload": {
    "access": {
      "nonce": "0AAhWVyXwhyY7Nk8oGLFdIPv"
    },
    "request": {
      "authentication": {
        "device": "EIcNq7KeNz54g9bJbYL87VK83YSzNUXXKfLZMmMEBQb2",
        "identity": "EJ_0GWDWEO5_147xvTIIR94MSalYQ_haXg0_MbGTFaBI",
        "publicKey": "1AAIAh2TQRHwjc3AnkH92s1lSRrujfDfOI8SXs8rpb26hDzv",
        "recoveryHash": "ECbnTNMWa4eJBx_RZdetPWh4QJ1lCEfz4_3_Pj3u-8ZM",
        "recoveryKey": "1AAIAqMfP4eY4TzVtK7gWYbS6G7m4RW23uLSDq_OLwFlTjlV",
        "rotationHash": "ELMgW2yWYFUjKXFiFPBZuXaYw1vyk8rTDHWf4ZZXtyon"
      }
    }
  },
  "signature": "0IABMd20fxa5rCscWJG5UB_gi3s3VAoqVGqqfzOunTFy5vVjlp16r2BUurI_r8pMvMjuUsu8oZjmXd_g7Uh_Z7Vb"
}
```

The server verifies the key by looking up `recoveryHash` and recomputing. If the hash matches, the
signature is verified using `recoveryKey`. `device` should be checked for uniqueness. If all is
well, the backend registers `publicKey` and `rotationHash` against a key that looks like
`(identity, device)`.

`response`

```json
{
  "payload": {
    "access": {
      "nonce": "0AAhWVyXwhyY7Nk8oGLFdIPv",
      "serverIdentity": "1AAIAqIT42GJw-M5tCuE0_9zVUBIOTgSlBoVsPGgx_i5p0lr"
    },
    "response": {}
  },
  "signature": "0ICjKpJ5F2iX-zq4k_S2K0tGGV8tI3INg-d87pYFctcaus9avVpRtaEQsQC8NEOVv9ad7bkJaU8rxU7t-ry6obZ4"
}
```

### Device

#### LinkDevice

This is a link container, it is generated by the new device, and contains enough data to link a
device to an existing identity.

```json
{
  "payload": {
    "authentication": {
      "device": "EM9MnUABj7vcjZVkxaUGp3avVekn95sbJTzfF5_VLLNI",
      "identity": "EBORvlvmBkZvRNXHQ0gF5nuqEwoPW5TH6cpahDpp4bjM",
      "publicKey": "1AAIAnsOjRzzHpxfxbiL2vMoXCvoSqiJiE-Grkv_EgKyrZ5V",
      "rotationHash": "EDBdHflCJPkR7RUb918q6gpnZQCtCSbTwk6zL1vBmpxt"
    }
  },
  "signature": "0IA34K3h0LtmblC2X9qT57vUq2XrQrEoJp_HgLHN0FwNR2vGwQph__uxsl9ichML9NmdwIfBmMXdv3AV3jtTpjOV"
}
```

The container is embedded in a message created and signed by the existing device. A rotation is
performed by the existing device.

`request`

```json
{
  "payload": {
    "access": {
      "nonce": "0ACfg5r4dCDg1SUCGCH9BaFK"
    },
    "request": {
      "authentication": {
        "device": "EKd76BaGOObJTIcGFGX6ql0IW05DESgYX5nbNjnTlNUH",
        "identity": "EBORvlvmBkZvRNXHQ0gF5nuqEwoPW5TH6cpahDpp4bjM",
        "publicKey": "1AAIAjzuMzAhD3hibZDbX0WWv315iCqRePbBEjUuk14thr26",
        "rotationHash": "EBtlgdPYcmvsJ6KQr46KoGbbqgukese-HL6yaelZj_rt"
      },
      "link": {
        "payload": {
          "authentication": {
            "device": "EM9MnUABj7vcjZVkxaUGp3avVekn95sbJTzfF5_VLLNI",
            "identity": "EBORvlvmBkZvRNXHQ0gF5nuqEwoPW5TH6cpahDpp4bjM",
            "publicKey": "1AAIAnsOjRzzHpxfxbiL2vMoXCvoSqiJiE-Grkv_EgKyrZ5V",
            "rotationHash": "EDBdHflCJPkR7RUb918q6gpnZQCtCSbTwk6zL1vBmpxt"
          }
        },
        "signature": "0IA34K3h0LtmblC2X9qT57vUq2XrQrEoJp_HgLHN0FwNR2vGwQph__uxsl9ichML9NmdwIfBmMXdv3AV3jtTpjOV"
      }
    }
  },
  "signature": "0IARmgp45duSRHEw59PdubfC0Flwk2IJGKIIv7vFVEoax3ByPYaPmEm85q3x-zWNz9nYU7xQTj0hp1PtYnmqjjuH"
}
```

After verifying the authentication signature from the existing device (via the `authentication`
part of the request), the `link` object is parsed and verified, and a new set of device keys is
registered in storage.

`response`

```json
{
  "payload": {
    "access": {
      "nonce": "0ACfg5r4dCDg1SUCGCH9BaFK",
      "serverIdentity": "1AAIAjvyqhtStWKRaRVjZ4PtBvgIW8aiYX4K5eQEh-xud3Vx"
    },
    "response": {}
  },
  "signature": "0IBHeDkykYM_alvHVpC5gJYOIMDNMS3_3Hg2rygoMfVYAvzlwHVg-Z_uXFLqLhbB8MhfUR06FowfT1jrG8yWTRtV"
}
```

#### UnlinkDevice

Unlinking involves a rotation followed by revoking access to the linked device. If the device is the
same device that is authenticating via rotation, we also double hash the rotation hash so that a
future rotation is not possible while simplifying backend logic.

```json
{
  "payload": {
    "access": {
      "nonce": "0ADFPjfZ_QQiRPVWH3vvNn_-"
    },
    "request": {
      "authentication": {
        "device": "EM9MnUABj7vcjZVkxaUGp3avVekn95sbJTzfF5_VLLNI",
        "identity": "EBORvlvmBkZvRNXHQ0gF5nuqEwoPW5TH6cpahDpp4bjM",
        "publicKey": "1AAIAznaMF_aVWPXZi83Y3PKwsf8mGnQym1EL8-AdGEuoWGr",
        "rotationHash": "EOBxWvzXT4mci_htA21-C2g5Yw924SN_SqQNAuDX-TZZ"
      },
      "link": {
        "device": "EKd76BaGOObJTIcGFGX6ql0IW05DESgYX5nbNjnTlNUH"
      }
    }
  },
  "signature": "0IAVkiNVcioJFNoM5bUFf3SNFKcB7tUT5zEaplv2JwMHSoMxnD082SAj7GO4yrHc3umVVkhAvZ1HEPsks4ydV2gx"
}
```

```json
{
  "payload": {
    "access": {
      "nonce": "0ADFPjfZ_QQiRPVWH3vvNn_-",
      "serverIdentity": "1AAIAjvyqhtStWKRaRVjZ4PtBvgIW8aiYX4K5eQEh-xud3Vx"
    },
    "response": {}
  },
  "signature": "0ICzVKNgPSulMItYqyiPqRdYemH_r6A6nwLecYi5l-oTHF3jLykQeVz2wBaFlaYuHJdBmu2YDbnD8FoB3KOQPkf4"
}
```

#### RotateDevice

To rotate to a new key, the device reveals the hidden rotation key, turns it into the public key
for that device, and establishes a new rotation key using a hash, signing with the newly-revealed
key. 

`request`

```json
{
  "payload": {
    "access": {
      "nonce": "0AD-6VwXbCX8cvRIdwaRrGvZ"
    },
    "request": {
      "authentication": {
        "device": "EOnMhfF6CIKCvXrZkRxwPMBRy6MwgwSBM0H6hb1uDezu",
        "identity": "EDuDnuc2x21LfxlPQvvKSQoaOqOCMpoi4bbuX7DlsIEg",
        "publicKey": "1AAIAtyDmFoPNHBnvd_ABDDmRqSWPjLG44UJXX-vb9-fYZkX",
        "rotationHash": "EFMfoXB0rwozYH7E5PIr_-k1ur6d3rR2oQcCiOq6f6-j"
      }
    }
  },
  "signature": "0IDxX3fdfoIouzhhdHFLGUYH3Vg7nntIl0WZbbewZyJT5CS_O2KqJLFM4J2OBroYA6HKAay2Fa9A533bdTTR3PCm"
}
```

`response`

```json
{
  "payload": {
    "access": {
      "nonce": "0AD-6VwXbCX8cvRIdwaRrGvZ",
      "serverIdentity": "1AAIA3gwJej58j_uVqUln-CjkaRihnQophMChhFNq_6bBvRE"
    },
    "response": {}
  },
  "signature": "0IAnQ9Q2H88Jx_Y-U_6ZmE38gdE6boVKJXjCcORb-v-Q7Ujs1CCJ4kfBtsxsntjztfTPT0D8J23SrrJ_AqIu179A"
}
```

### Session

#### RequestSession

Authentication is accomplished with a challenge/response performed in two phases.

`request` (request for challenge)

```json
{
  "payload": {
    "access": {
      "nonce": "0ACsNpWIt0v5eHGsxH0M8QTj"
    },
    "request": {
      "authentication": {
        "identity": "EDuDnuc2x21LfxlPQvvKSQoaOqOCMpoi4bbuX7DlsIEg"
      }
    }
  }
}
```

`response` (challenge)

```json
{
  "payload": {
    "access": {
      "nonce": "0ACsNpWIt0v5eHGsxH0M8QTj",
      "serverIdentity": "1AAIA3gwJej58j_uVqUln-CjkaRihnQophMChhFNq_6bBvRE"
    },
    "response": {
      "authentication": {
        "nonce": "0ABxz8gcyHcjkMkbCjH3b_Th"
      }
    }
  },
  "signature": "0IB3aM8sIEHP1YoGzzqtFkiJbqgPs2NsArlj7nAQ9rmfD0w_cZGKdtj6CEENMYVTjc2AIIiqQCSpfX_UJbV-gWB_"
}
```

#### CreateSession

`request` (response to challenge)

```json
{
  "payload": {
    "access": {
      "nonce": "0ABK8TtVAc2bb7Ssxi_STdtL"
    },
    "request": {
      "access": {
        "publicKey": "1AAIA9EMgNwuFzAPHPFNGAe0swMBTG8WAkfhNTb5poal4UWV",
        "rotationHash": "EM7gjR8bZEVuKBGcH-c5aeW3RbPWS1mfA-TWtIfpyDzs"
      },
      "authentication": {
        "device": "EOnMhfF6CIKCvXrZkRxwPMBRy6MwgwSBM0H6hb1uDezu",
        "nonce": "0ABxz8gcyHcjkMkbCjH3b_Th"
      }
    }
  },
  "signature": "0IArYB6phCGYj_AjSAmjlIFYOSMPSrrdZ1-ZtXO6y6BLApPWOUfcNcWai32d39CEYTAar5YOtlZxW5JUzOUMSDFM"
}
```

`response` (grant)

```json
{
  "payload": {
    "access": {
      "nonce": "0ABK8TtVAc2bb7Ssxi_STdtL",
      "serverIdentity": "1AAIA3gwJej58j_uVqUln-CjkaRihnQophMChhFNq_6bBvRE"
    },
    "response": {
      "access": {
        "token": "0IAVQiaMsh71KkFB6OUR83VARZ19lpWop_R0pCijpw0URTcDHwOBO09fib6ML86OqjcrCHF-nQi0Rq8QwkIb9I3xH4sIAAAAAAACA22PW3OiQBCF_8s8xy3AW-QNBHXKBQlqcE2lLAYamIjAzgXElP99x33YfUi6-qnrfOec_kQcWAsMp1AJKnpkIt2ysEUT3OImifDZ-wX5yZ91uOoOcNqXodHU5HDaD-kJjvXl5qMnlEJLE1Csu6m8IltM5ng9bw_seA6vXeDZYT_xurzb2p62mhRElw7cpOLo_1TXkU4lE-Nq6D-zaxm8tO16-1LHm9-budfUdESIPEydkmM3V2QjSUmTNfwrPHO93O_k4mYFq2DhLy3QeOfZu-VzZJ2zwt-RcVPH5WgfvSqc1SIWtK5WMS8e4d40_wifydF9lWt7mawGyTiGaBiSINrql8wa7CKBs6Z3bvxRm3MJqSUUaWjGeKBranfa1NQ005j9GOlD7e8clRauDWX9F6U-_qJkkDHghfsNoM--s46FYJRIARyZn6gBdlHF1FPc7sO6hMcxTi-0QuabMo9ThXSMCkDv9_v9DxsEsH35AQAA"
      }
    }
  },
  "signature": "0IB1oi2Bm1WxO0L1g_olrlYy-vntOvqdbMd-lZ6-tLVmKpEM9rStLJqmPrt7rv8TsxYnKq9Y_KIcFNcxUe3Ee3qY"
}
```

#### RefreshSession

This rotates the access key.

`request`

```json
{
  "payload": {
    "access": {
      "nonce": "0ADM10vVTKi6-MCgI3NN4jbc"
    },
    "request": {
      "access": {
        "publicKey": "1AAIAnph1SSe3xK1dN6XNPrWYrT9lam48FIQ_sVDD0ES9Zs9",
        "rotationHash": "ENLSm_-KPtNjYxcZ83mDld8Vm6qq4Lfwe4ltow2Jy1D4",
        "token": "0IAVQiaMsh71KkFB6OUR83VARZ19lpWop_R0pCijpw0URTcDHwOBO09fib6ML86OqjcrCHF-nQi0Rq8QwkIb9I3xH4sIAAAAAAACA22PW3OiQBCF_8s8xy3AW-QNBHXKBQlqcE2lLAYamIjAzgXElP99x33YfUi6-qnrfOec_kQcWAsMp1AJKnpkIt2ysEUT3OImifDZ-wX5yZ91uOoOcNqXodHU5HDaD-kJjvXl5qMnlEJLE1Csu6m8IltM5ng9bw_seA6vXeDZYT_xurzb2p62mhRElw7cpOLo_1TXkU4lE-Nq6D-zaxm8tO16-1LHm9-budfUdESIPEydkmM3V2QjSUmTNfwrPHO93O_k4mYFq2DhLy3QeOfZu-VzZJ2zwt-RcVPH5WgfvSqc1SIWtK5WMS8e4d40_wifydF9lWt7mawGyTiGaBiSINrql8wa7CKBs6Z3bvxRm3MJqSUUaWjGeKBranfa1NQ005j9GOlD7e8clRauDWX9F6U-_qJkkDHghfsNoM--s46FYJRIARyZn6gBdlHF1FPc7sO6hMcxTi-0QuabMo9ThXSMCkDv9_v9DxsEsH35AQAA"
      }
    }
  },
  "signature": "0IBdGmMFgav56RrzbSH5zESlDmnOcfZwDjDmVRb8qeAtraePlCVk-5TwWEeF_71NhzGDBBg6F6LAho0zb_Zbanzh"
}
```

`response` (new token)

```json
{
  "payload": {
    "access": {
      "nonce": "0ADM10vVTKi6-MCgI3NN4jbc",
      "serverIdentity": "1AAIA3gwJej58j_uVqUln-CjkaRihnQophMChhFNq_6bBvRE"
    },
    "response": {
      "access": {
        "token": "0IAHUkb4GJDgdpdB4SFezmbYJwwSITWl6jTsh7kIHqSkHHDfOHqT5QqCmKCTLGcIjlqVefsHG1mfjmDEjOLoqkqRH4sIAAAAAAACA22PSVODQBCF_8uc1WIIYuCWBCxHAllwIVgWxdIJo2yZGTat_HcnHvSgXX3qet97rz8RB9YBIxlUgooRmQjPZmRGU9KRJn0m7-4ODpFn9KTqA4gei63a1EkQPU5oBGFdfnjoAmXQ0RQka68qN9_f6gviLLqAhe_boV-78-2ou_2h9-eucqfnCW4t-GglR39Tbau1qjZVBxUv90Ox3nSd42_qeHVcLdymplqStMGNVXBiHyTZtElBUwd-CldNjn0fJoODM08PvDV73rEHo4hLbXpLNhF_sizF9o2QGxJntYgFrau7mOfncG_pl9Glsxbe225Iw-mktIps-lTqx6O23PegFaLu1fsRW9q5NuctZDMhSVVRry-xIvdBuTEVxVSNKw1Ple8JpRaGhrLxjxJf_1Ey2DPguf0PgI0f68kvEAvBaNIK4Mj8RA2wUhaTT_H5uK0LOB_jrKQVMl-keZxJpGdUAHo9nU5fQziaMfkBAAA"
      }
    }
  },
  "signature": "0IC5f9WVJ5vS_IcJ3YTJ6GyG919MKWeR0_OKa0RnXSeXmzP5_rr5dipiCNfWdskd_UIg5OkQmk-rORUlApVIhkgm"
}
```

### Access

An access request is a resource request that is verified using the embedded token.

`request`

```json
{
  "payload": {
    "access": {
      "nonce": "0ADbScJs8Q_ygA0DZGlkOL1t",
      "timestamp": "2025-10-10T07:00:29.423000000Z",
      "token": "0IBnfopW9UnJRTsScouJPYtrj4_UKWtZZ4QP4DP--7-F569u3TWf8OFrQSXNCCBXZdwZ6gDv1qlJtIg67AIofer3H4sIAAAAAAACA22PW2_iMBCF_4uftyvbhFveAmRFNoRbSptSrVAuAzG5ONjOBSr--7qVdvvQjuZpdL5zzrwhCaIB4SRQKqauyETEshyLxU7jVPGzk3kvcDosx61TtgEcdvmWVjwKDrseO8CeF7cl-oESaFgMmrVXpZcefw2mjjttArHPtl279ibb68BrT60_8fB8kEaknsGt1hz7TLVn9aysY9pRsjh2-XrTNK6_4eHqspp6FWdGFNXBcJZLxz5psqqjnMUu_C9828luPrUu2ehpcd50VuYWRff4zP1eTKXy_SeyxOJi2YmRaVxwFSrGy3ko04_wbDNknA6JfTTw7WHFR0Zatc369zng2f7cD9NRdXJfFkUA77WlrCGxlCYppv0HgvU-4qGJsUnHPw1K8cfstRa6ionrFyXpf1EKOAqQqf0NQMb_rEnvEwiVEiyqFUhkvqEKRKGL6afk5LrlObwfw6RgJTJftXmYaKQVTAH6c7_f_wKu4aOm-QEAAA"
    },
    "request": {
      "foo": "bar",
      "bar": "foo"
    }
  },
  "signature": "0IAOA9rrhzyB9VcL3aXPJWbVD-j4ju6Zol3_xG_wsJf9QWRgL_wZbE7kbokLmesHUmOPbLbhzlSbvZbwUXefF5DE"
}
```

`response`

```json
{
  "payload": {
    "access": {
      "nonce": "0ADbScJs8Q_ygA0DZGlkOL1t",
      "serverIdentity": "1AAIA3gwJej58j_uVqUln-CjkaRihnQophMChhFNq_6bBvRE"
    },
    "response": {
      "wasFoo": "bar",
      "wasBar": "foo"
    }
  },
  "signature": "0IBDGQCj_tZyyXw_vY7a3AHFIASc3eCfHb_diU8iHnmjHbowIGjqeyohrV0L62c21W5gRAU9yTGDzLfxbpaky5CL"
}
```

## Appendix

### AccessToken encoding

If we re-pad a token from the example implementation with `=`, we can decode it in a shell (the
first 88 bytes is the signature, in this case):

```sh
TOKEN="0IAGTf0y29Ra-8cjCnXS8NlImAi4_KZfaxgr_5iAux1CLoOZ7d5tvFktxb8Xc6pU2pYQkMw0V75fwP537N9dToIyH4sIAAAAAAACA22PXY-iMBSG_wvX203rUBHuOgIDasQ1jC5uNobaKkU-TFtAZ-J_nzoXu8nOnsuT93k_3i3FZc9lzHijhb5ZnoUIiUl_mNkp0isAWHpgCzKMWSaghJvE309VxifT6_no3Nh1G1jfLMZ7ceCGDYJhvIoDqXySVCAcPdfc2VFYlHG-TabDa0leu1NE56Byc8OJv6lB0taqqFx5jGadHfUiTU9OHYrFXp17FmKIdpfMZk80ileGvHS0Eoc5_1P4jVIM1qW92Qb-7keC6-HlxZH-Yjm-Coxilm1Q2-AV3dPO4LLVuRZtE-WqeISHIZDEGWe125Z-BnVHxc9NuQZk3c-XziyS5-2ybt6OpyJ51Faq44xoQ47gCAMEAZykaORh17PR9wnG8PN2RsuvFyFv_yifPGR_UUp-lFwVwRfATSH8n3WutRS001xZ3rt14bI2xcwo9XxbtxV_PHNWi8byfhnznBlkkEJz6_f9fv8A44o2TvkBAAA="
echo -n ${TOKEN:88} | base64 -d | gunzip | jq .
```

produces

```json
{
  "serverIdentity": "1AAIAvcJ4T1tP--dTcdLAw6dYi0r0VOD_CsYe8Cxkf7ydxWE",
  "device": "EEw6PIErsDAOl-F2Bme7Zb0hjIaWOCwUjAUugHbK-l9a",
  "identity": "EOomshl9rfHJu4HviTTg7mFiL_skvdF501ZpY4d3bHIP",
  "publicKey": "1AAIAzbb5-Rj4VWEDZQO5mwGG7rDLN6xi51IdYV1on5Pb_bu",
  "rotationHash": "EFF-rA76Ym9ojDY0tubiXVjR-ARvKN7JHrkWNmnzfghO",
  "issuedAt": "2025-10-08T12:59:41.855000000Z",
  "expiry": "2025-10-08T13:14:41.855000000Z",
  "refreshExpiry": "2025-10-09T00:59:41.855000000Z",
  "attributes": {
    "permissionsByRole": {
      "admin": [
        "read",
        "write"
      ]
    }
  }
}
```
