# better-auth

Examples given are encoded using CESR (Composable Event Streaming Representation) and ideas
surrounding forward secrecy came from KERI (Key Event Receipt Infrastructure)

The examples given were generated by the [reference typescript implementation](https://github.com/jasoncolburne/better-auth-ts)
which is a great place to learn more about how this works.

## Protocols

### Creation

generate a creation container on the server and deliver to client out of band

```json
{
  "payload": {
    "access": {
      "nonce": "0AAB_q-GWLsh28GOSxV8M9qt",
      "responseKeyDigest": "EI58USf6nQ5ZfHwdEDSMjL13HhHPJYLl23soAUSwjTWG"
    },
    "response": {
      "creation": {
        "token": "EKPp3dE8X6vDDRzphXNOhcLYCIZey2dPvyllbW_hmI_L"
      }
    }
  },
  "signature": "0IC81rjcMJUtTjA6Nrna0h923q4VhB8IQR1-5S49AIYwhmM837UimDINpG_wLy2K_tn1RJnmQalUjjZnrIqHTb27"
}
```

request

```json
{
  "payload": {
    "access": {
      "nonce": "0ACAJ8aVjgMbwZqmVLZc7qhp"
    },
    "authentication": {
      "publicKeys": {
        "current": "1AAIA_FCzibj8poMX-nqTtLAgq1uiVzSldHXC_9E7v_a67yP",
        "nextDigest": "EBGalZap5Cn29zW33NP31pW_gKNA44KkXKY2pRaknRIu"
      }
    },
    "creation": {
      "token": "EKPp3dE8X6vDDRzphXNOhcLYCIZey2dPvyllbW_hmI_L",
      "recoveryKeyDigest": "EBhLnrwEQMVeuiigwItnuMRNuamcll1TBN4ifbM43gqm"
    },
    "identification": {
      "deviceId": "EONI1h1LL9uzq2QJ5LLHYigP90mqK04b0LPr-rsEXwE2"
    }
  },
  "signature": "0ICN5ZMx3XE5R1VaZRdyHXiP9PAfSgnpXY6AuN16SmBhLu3DgjTO5MnAcSpyrf1NTrqcRxa-zUKhak1qYrk8_dF7"
}
```

response

```json
{
  "payload": {
    "access": {
      "nonce": "0ACAJ8aVjgMbwZqmVLZc7qhp",
      "responseKeyDigest": "EI58USf6nQ5ZfHwdEDSMjL13HhHPJYLl23soAUSwjTWG"
    },
    "response": {
      "identification": {
        "accountId": "EONmrU2RYABj6aHQYl6zOMPRkyHKJBin8jJwKW3XroTL"
      }
    }
  },
  "signature": "0ICL9S1hfFUitfyNpUmvfK30tQb4tb_0062InZLoMOzBwOLHpg-fu_GAOEismYxeZoWnH2oyMKtCieoUGKQlsTyP"
}
```

### Recovery

request

```json
{
  "payload": {
    "access": {
      "nonce": "0ADly1b6dcM5WharmsY9RS9x"
    },
    "authentication": {
      "publicKeys": {
        "current": "1AAIA6Ruhn2769Xh2v42aeToqCYV-Fthlik8RsnvbBsY_h-K",
        "nextDigest": "EJBQAcIP9M8_MRw3QYbQEzoKiy7n_pNqZdRlWJxVRa4U"
      }
    },
    "identification": {
      "accountId": "EONmrU2RYABj6aHQYl6zOMPRkyHKJBin8jJwKW3XroTL",
      "deviceId": "EGoCUuJOpLI9XZbJruMVEAk5shvCMIubgzEph1lGxDNa"
    },
    "recovery": {
      "publicKey": "1AAIAxiGPiM4pPAh2tiROgmkckVfHaLogOOzyNILZ3mLRkFD"
    }
  },
  "signature": "0ICrGyVFOiFyAeb-KYKbaslgDnc8mrwO1apD3sJXPCpNSXITBkZsVvjNGKv56Ol3uYk4ajglcPkmctEpTvCRFxxw"
}
```

response

```json
{
  "payload": {
    "access": {
      "nonce": "0ADly1b6dcM5WharmsY9RS9x",
      "responseKeyDigest": "EI58USf6nQ5ZfHwdEDSMjL13HhHPJYLl23soAUSwjTWG"
    },
    "response": {}
  },
  "signature": "0IC1ohp1EXGve9I26oOs95X8Fpp6OSz0mbn0QVs1MPaF0qMZ7GAl9l8thnVbodjkKDWmWzT1kVAz9DVJHZspoaWN"
}
```

### Linking

this is a link container, it is generated by the new device

```json
{
  "payload": {
    "identification": {
      "accountId": "EONmrU2RYABj6aHQYl6zOMPRkyHKJBin8jJwKW3XroTL",
      "deviceId": "EGTnzr5LfIL2UHdDr__poAdNSQIpeOrVIKkNmzweHMQy"
    },
    "publicKeys": {
      "current": "1AAIAwbbEHbEABWXPtYbbIYOK-3zAjGjcKWdAn0pzh5Rhk2O",
      "nextDigest": "ELpoiaEYIKWiC7hRo95YVSF5nx_efQaPtSJevjXb6Dxw"
    }
  },
  "signature": "0IAGMddtXVMoxSJh6-QXe4hCeeBxrPY09uVkzleXE0L1Q1pYRWrFiCRIuzRNR4RBeKrmon3y2NQd03ZUD5nDxxRB"
}
```

the container is embedded in the existing device:

request

```json
{
  "payload": {
    "access": {
      "nonce": "0AAkFh7k3qWvZNhdjY-Gv9pC"
    },
    "identification": {
      "accountId": "EONmrU2RYABj6aHQYl6zOMPRkyHKJBin8jJwKW3XroTL",
      "deviceId": "EONI1h1LL9uzq2QJ5LLHYigP90mqK04b0LPr-rsEXwE2"
    },
    "link": {
      "signature": "0IAGMddtXVMoxSJh6-QXe4hCeeBxrPY09uVkzleXE0L1Q1pYRWrFiCRIuzRNR4RBeKrmon3y2NQd03ZUD5nDxxRB",
      "payload": {
        "identification": {
          "accountId": "EONmrU2RYABj6aHQYl6zOMPRkyHKJBin8jJwKW3XroTL",
          "deviceId": "EGTnzr5LfIL2UHdDr__poAdNSQIpeOrVIKkNmzweHMQy"
        },
        "publicKeys": {
          "current": "1AAIAwbbEHbEABWXPtYbbIYOK-3zAjGjcKWdAn0pzh5Rhk2O",
          "nextDigest": "ELpoiaEYIKWiC7hRo95YVSF5nx_efQaPtSJevjXb6Dxw"
        }
      }
    }
  },
  "signature": "0IAn0Ic6DnKEBeuI9smLFa_cMOugyIwrex6YhyWcm6L9WqgVDWrsjluz-hoIumCu2Tbd7kMicm4ztKOx1QkXyHEz"
}
```

response

```json
{
  "payload": {
    "access": {
      "nonce": "0AAkFh7k3qWvZNhdjY-Gv9pC",
      "responseKeyDigest": "EI58USf6nQ5ZfHwdEDSMjL13HhHPJYLl23soAUSwjTWG"
    },
    "response": {}
  },
  "signature": "0IBKyv3iSGX87j4JdAKKBwGVfQSCEA27SpzJyNK2pw2Uwurl8bPhASz8sww8-14t6-G-X543eNFifaDAr1HhnRJf"
}
```

### Rotation

request

```json
{
  "payload": {
    "access": {
      "nonce": "0ADtEkAU7uDQIchGZkZwj3bA"
    },
    "identification": {
      "accountId": "EONmrU2RYABj6aHQYl6zOMPRkyHKJBin8jJwKW3XroTL",
      "deviceId": "EONI1h1LL9uzq2QJ5LLHYigP90mqK04b0LPr-rsEXwE2"
    },
    "authentication": {
      "publicKeys": {
        "current": "1AAIA5nI1GAdoE3THKASWifldnuycK5IWIK1AgP_tv2os6OM",
        "nextDigest": "ENLWboPWJinZ2HlZfXFekIGcrmb7--HinmEBhjf7prSp"
      }
    }
  },
  "signature": "0ICrx_W8hZ_65pzWakSQt7OcmkD0q6wsZRfIhss1WQvFUUkyIyZv0e1vU2s1CWZeYf2j2RHQoxGuUsNgemgYaya-"
}
```

response

```json
{
  "payload": {
    "access": {
      "nonce": "0ADtEkAU7uDQIchGZkZwj3bA",
      "responseKeyDigest": "EI58USf6nQ5ZfHwdEDSMjL13HhHPJYLl23soAUSwjTWG"
    },
    "response": {}
  },
  "signature": "0IBZcxZhjyFmz_0eNlLcW-3GL-jSdnVX2pgZAicntygElh6q4UCwAzBqKMWBEIT1BopW7QLMsi_D3wwK_RZf-4fe"
}
```

### Authentication

request (request for challenge)

```json
{
  "payload": {
    "access": {
      "nonce": "0ADKMX7Cy4jylVVCF2OHmEHw"
    },
    "identification": {
      "accountId": "EONmrU2RYABj6aHQYl6zOMPRkyHKJBin8jJwKW3XroTL"
    }
  }
}
```

response (challenge)

```json
{
  "payload": {
    "access": {
      "nonce": "0ADKMX7Cy4jylVVCF2OHmEHw",
      "responseKeyDigest": "EI58USf6nQ5ZfHwdEDSMjL13HhHPJYLl23soAUSwjTWG"
    },
    "response": {
      "authentication": {
        "nonce": "0AD8GJck-6kaWkYF3boh6FwI"
      }
    }
  },
  "signature": "0IDSHW_4qh7rYt3NXaXdDvYNJ0mTy6UGMeaLjPA6TA9kvqgQAHqA0A0-PweA0QNf7WqIzaq8NgcoVP-IG_FmHnCR"
}
```

request (response to challenge)

```json
{
  "payload": {
    "access": {
      "nonce": "0AAl5v2HnDXcM28XXXUOplQ6",
      "publicKeys": {
        "current": "1AAIA5xSkngGxk0S4Bdblf7l0OO5CjppswSFDy4jCgTJ5Qhp",
        "nextDigest": "EAgop3tbm_12oIHV2R1LwBjmD08E2F0YLXRqt1rUpG7L"
      }
    },
    "authentication": {
      "nonce": "0AD8GJck-6kaWkYF3boh6FwI"
    },
    "identification": {
      "deviceId": "EONI1h1LL9uzq2QJ5LLHYigP90mqK04b0LPr-rsEXwE2"
    }
  },
  "signature": "0IA-74kKcA3-KZ3nf2zqP2BvTJMv1cIqgzRX0KJlruoAJkE2-mHxXIPOTpc1zn1fWZLkj-sJfT7Sh4siwqF4Uc9U"
}
```

response (grant)

```json
{
  "payload": {
    "access": {
      "nonce": "0AAl5v2HnDXcM28XXXUOplQ6",
      "responseKeyDigest": "EI58USf6nQ5ZfHwdEDSMjL13HhHPJYLl23soAUSwjTWG"
    },
    "response": {
      "access": {
        "token": "0ICChvCp8G3xXB8gQNaCGm71HpnOk_l3MCnVyN3FDxyFQgjsB22ktTfMOFNQG8ChPRSfVNigjhXHb_iidcoJ-q_0H4sIAAAAAAACA22O21KDMBRF_yXP1gnhUuQttPRGFQtUWx3HgZLSUC4xCQPY6b8LPmrP45619j4XEB0OVV3KZQIs4HhPBd8if4_tzIgWm31ufHuPz_65W7grm5ZmtmrcV3XHq3AN7gCr45weXNL1qoLxEuttcC7TeXuGgWYncX4c59Dz9EnGmGiC2bTTskkarvTNifV6SVo5pSkRcpjGacVUGRefCqqWixfkK-vGzoopNB00g_v1zv-SCt-y-XiYpkLUJMGDiSDSR_BhhLQQKpZmWqpxr6sI_t5bz5KWUd79IZEF1X8kJ0dOxMm5ISjqrepISk7jWhIBrAtghBf9Y7Qqhd35VU6GMEoKWgLrvS-Pkl5pOJUEfFyv1x-o9MRlfAEAAA"
      }
    }
  },
  "signature": "0ID173tI_QCB0FyE2GlArg6oxUA9WnX7V6FGh3Va--USgJiVtypWRazV6jSfMHFRdmc7r3UtEy-mxJmsqWtJa7jx"
}
```

### Refresh

this rotates the access key

request

```json
{
  "payload": {
    "access": {
      "nonce": "0ADJ4M7I_kvVuP6-NZtw60We",
      "publicKeys": {
        "current": "1AAIAzIUi60_C6sB8yM9g2FFmVL4iQziW_IfuvNp5QXeO3Mc",
        "nextDigest": "EEeBlhlCmraMJybXq9m0GR4Y-ROnFnFx_ely9lYQS3Ds"
      },
      "token": "0ICChvCp8G3xXB8gQNaCGm71HpnOk_l3MCnVyN3FDxyFQgjsB22ktTfMOFNQG8ChPRSfVNigjhXHb_iidcoJ-q_0H4sIAAAAAAACA22O21KDMBRF_yXP1gnhUuQttPRGFQtUWx3HgZLSUC4xCQPY6b8LPmrP45619j4XEB0OVV3KZQIs4HhPBd8if4_tzIgWm31ufHuPz_65W7grm5ZmtmrcV3XHq3AN7gCr45weXNL1qoLxEuttcC7TeXuGgWYncX4c59Dz9EnGmGiC2bTTskkarvTNifV6SVo5pSkRcpjGacVUGRefCqqWixfkK-vGzoopNB00g_v1zv-SCt-y-XiYpkLUJMGDiSDSR_BhhLQQKpZmWqpxr6sI_t5bz5KWUd79IZEF1X8kJ0dOxMm5ISjqrepISk7jWhIBrAtghBf9Y7Qqhd35VU6GMEoKWgLrvS-Pkl5pOJUEfFyv1x-o9MRlfAEAAA"
    }
  },
  "signature": "0IBOk2HQTGkXhIpTL2btFJ1NWPEskD1JbjVwk09Z3S0MAxJsWepqivSVgvsuzxbuPf8dmiH8NyMyuKMKdZpUO-Fe"
}
```

response (new token)

```json
{
  "payload": {
    "access": {
      "nonce": "0ADJ4M7I_kvVuP6-NZtw60We",
      "responseKeyDigest": "EI58USf6nQ5ZfHwdEDSMjL13HhHPJYLl23soAUSwjTWG"
    },
    "response": {
      "access": {
        "token": "0ICMw7VBUWBxgi1BWSDrDmgssjqj5BOsChj_1l-wp2VNHMn35qc6BBejOxOqwvLb0BnrgB_6YnXV4KBzgBcsvCkXH4sIAAAAAAACA23O3VLCMBAF4HfJtTghKZX2rgUqBUptBaE6DlPaAMH0xyQVAsO7G7zQGXUvd853ds8gzbKqKaWfAxsMwmnB5yhOHHdvpsMoYeYpDB7iNzUcj1xadvejw3iBl7yaTcANqJs1o9mYKE3bjuM7J39OTbjqmcLtqsDaIs8rniYGjU50sfI3zce07kRLEuIg07wkR9mnWyLk9fSAuGzHegVPg5FaL9-tAt7HRtKKw9IrveOKMGWxJHrEfaEtFaIhuXOVCKJOC1otZMxg2za6NjZvO_gOfs2zzpJjTbn6lUQ2xH-SnGw4EbvBP6CNv6vRD0il5HTdSCKAfQY14YV-jFalcFVcMXJdpnlBS2C_6PI01-TAqSTg9XK5fAJ-_VejfAEAAA"
      }
    }
  },
  "signature": "0IC79tVomDk8d3pSXv_9Xg7_IbXQBvsoOvhr6qYXxW_Goi40KxGi_O19O2RN6xcDwJb2CuTQsLr_kozilzzEuFdz"
}
```

### Access

request

```json
{
  "payload": {
    "token": "0ICMw7VBUWBxgi1BWSDrDmgssjqj5BOsChj_1l-wp2VNHMn35qc6BBejOxOqwvLb0BnrgB_6YnXV4KBzgBcsvCkXH4sIAAAAAAACA23O3VLCMBAF4HfJtTghKZX2rgUqBUptBaE6DlPaAMH0xyQVAsO7G7zQGXUvd853ds8gzbKqKaWfAxsMwmnB5yhOHHdvpsMoYeYpDB7iNzUcj1xadvejw3iBl7yaTcANqJs1o9mYKE3bjuM7J39OTbjqmcLtqsDaIs8rniYGjU50sfI3zce07kRLEuIg07wkR9mnWyLk9fSAuGzHegVPg5FaL9-tAt7HRtKKw9IrveOKMGWxJHrEfaEtFaIhuXOVCKJOC1otZMxg2za6NjZvO_gOfs2zzpJjTbn6lUQ2xH-SnGw4EbvBP6CNv6vRD0il5HTdSCKAfQY14YV-jFalcFVcMXJdpnlBS2C_6PI01-TAqSTg9XK5fAJ-_VejfAEAAA",
    "access": {
      "timestamp": "2025-09-24T01:48:36.539000000Z",
      "nonce": "0ABdzUZ4QTHfMRJtECnzMCsk"
    },
    "request": {
      "foo": "bar",
      "bar": "foo"
    }
  },
  "signature": "0IArBI5xLyzjU_QQQO-WXlHbK38jenQ1aIVYMS4JL6P4kmTQTBWsnrZJ9gYbfMLBeLaXeT68hAEAGeM2zKU7CuL4"
}
```

response

```json
{
  "payload": {
    "access": {
      "nonce": "0ABdzUZ4QTHfMRJtECnzMCsk",
      "responseKeyDigest": "1AAIAlM4bmruQ1OMzmq3Syl9RO3SbrP4aRjDvPWFusEcB7kn"
    },
    "response": {
      "wasFoo": "bar",
      "wasBar": "foo"
    }
  },
  "signature": "0IBLjJorYS1fQu74GFRa2Xi5HBIIAVzG0ao17D39GVbJsVGuEFYPgpBPCXOmH05SrG6G8fRa8iWeQNDpt7xhmtEL"
}
```
