# better-auth

Examples given are encoded using CESR (Composable Event Streaming Representation) and ideas
surrounding forward secrecy came from KERI (Key Event Receipt Infrastructure)

The examples given were generated by the [reference typescript implementation](https://github.com/jasoncolburne/better-auth-ts)
which is a great place to learn more about how this works.

## Protocols

### Creation

generate a creation container on the server and deliver to client out of band

```json
{
  "payload": {
    "access": {
      "responseKeyDigest": "ELB2mEllbn4s7uAga99YwAj7LDJg2ZCvKI4I5AbO_Ke7",
      "nonce": "0ACFepu8-IoVESKYgCOluWnh"
    },
    "response": {
      "creation": {
        "token": "EAanWA8ZCrd3oxxC3-tHEvd1Lzd3_5cAeFYo7DFIwAtN"
      }
    }
  },
  "signature": "0IAEGEkq0owXWua-N4D3qsEyaL0AZsMxoKdttxWCuAHcGwbTRQFwsS26I6nPkyAizNHcV-3snbPdLWWXqYAJp6QN"
}
```

request

```json
{
  "payload": {
    "access": {
      "nonce": "0ABFDSiFYgq_0bgFKiyGnzEk"
    },
    "authentication": {
      "publicKeys": {
        "current": "1AAIArTmLGOJL1wUiiAeQ04RbaA-j5JkMCTS2osuX9fV3bhm",
        "nextDigest": "EB4-xkPuExSfl5Ab7a0GHRwR_yQSgsBusVrO9Wjdql2A"
      }
    },
    "creation": {
      "token": "EAanWA8ZCrd3oxxC3-tHEvd1Lzd3_5cAeFYo7DFIwAtN",
      "recoveryKeyDigest": "EFlIf6lafTjKIgxYYhAzcSD7KVIaCJ-D4NqIIjAsUEi1"
    },
    "identification": {
      "deviceId": "EFwbPxaFzhbgCLOjaQucojOnPjk3flP0GuDznsQJ__8z"
    }
  },
  "signature": "0IBxAkixdyWSUSmXGftDP_zaW_u1IN5NtzcsI3T2Cjas7WMENGhO4-jWL4sRjxO8LHWf3myYrH1YzdWcpGcDNhI3"
}
```

response

```json
{
  "payload": {
    "access": {
      "responseKeyDigest": "ELB2mEllbn4s7uAga99YwAj7LDJg2ZCvKI4I5AbO_Ke7",
      "nonce": "0ABFDSiFYgq_0bgFKiyGnzEk"
    },
    "response": {
      "identification": {
        "accountId": "EPDNrcAWe_HRr2pxuKJ2Op7pldgUDJlMP1p5zIopOzx6"
      }
    }
  },
  "signature": "0IDx75_rDTLKp7N22P93Z-dK7BmdQGg3C7Al2jHINjndC-smhO5CXUyIn3ML90pEzcXyNmfMmLK7amdXv_CA8JxL"
}
```

### Recovery

request

```json
{
  "payload": {
    "access": {
      "nonce": "0AB_qAmgtw_SpmdXZ-QkzCUq"
    },
    "authentication": {
      "publicKeys": {
        "current": "1AAIAoywu2E0nEAdBDkfY8yl_f6lbwejxa0ER_oKUwzJ1Uz2",
        "nextDigest": "EH14y1jznBIdOk8gvOf58eeanBWXZH6P4oYCKU17AzlU"
      }
    },
    "identification": {
      "accountId": "EPDNrcAWe_HRr2pxuKJ2Op7pldgUDJlMP1p5zIopOzx6",
      "deviceId": "EEAZBH6rkbARwgy9T3GfZc2XhsxUC3ltbyZtFByEWlkp"
    },
    "recovery": {
      "publicKey": "1AAIAt3IQWfobitJRF_3WomDuRwoH7ndGkRvkE7qFRO7yIgp"
    }
  },
  "signature": "0IBnudHkc8_3VpqOaLcpJf8__Ioywi8jazcndj5f9T5irJnVu5XAb6cM3YOAHXhLOLCYaGVdeDFvHYH1hcsqwUm2"
}
```

response

```json
{
  "payload": {
    "access": {
      "responseKeyDigest": "ELB2mEllbn4s7uAga99YwAj7LDJg2ZCvKI4I5AbO_Ke7",
      "nonce": "0AB_qAmgtw_SpmdXZ-QkzCUq"
    },
    "response": {}
  },
  "signature": "0IAwB0q1RRWaByyY2_0kbvxHslWLWOlQrll5L70n0vpMxXuFJLiycs1JCpKwsbghggwbJDWqCU-2oNpOouPe36_I"
}
```

### Linking

this is a link container, it is generated by the new device

```json
{
  "payload": {
    "identification": {
      "accountId": "EPDNrcAWe_HRr2pxuKJ2Op7pldgUDJlMP1p5zIopOzx6",
      "deviceId": "EA6zEIgBjUxcCLs3cTmbtaSrYONBaxOE32tb6R7qehFx"
    },
    "publicKeys": {
      "current": "1AAIArB9u6gWx3Z0P5Vbe0aaUkZQnjEQBBtDpKxIz7nP0DK0",
      "nextDigest": "EAOyvIuMWvAeCTUA1AGJEtHugAE8FzwZCqjYC17YkTqN"
    }
  },
  "signature": "0IDwsC3pvwvurRzixLyclWq-A60f8JQgNHmiS8lS32VH6bSX1hTVh56a8GUCiR8Dp8HizhAYB8AyrTiJXpQrtNDe"
}

the container is embedded in the existing device:

request

{
  "payload": {
    "access": {
      "nonce": "0ACoZY_yInf7yc7n4xBO_UAo"
    },
    "identification": {
      "accountId": "EPDNrcAWe_HRr2pxuKJ2Op7pldgUDJlMP1p5zIopOzx6",
      "deviceId": "EFwbPxaFzhbgCLOjaQucojOnPjk3flP0GuDznsQJ__8z"
    },
    "link": {
      "signature": "0IDwsC3pvwvurRzixLyclWq-A60f8JQgNHmiS8lS32VH6bSX1hTVh56a8GUCiR8Dp8HizhAYB8AyrTiJXpQrtNDe",
      "payload": {
        "identification": {
          "accountId": "EPDNrcAWe_HRr2pxuKJ2Op7pldgUDJlMP1p5zIopOzx6",
          "deviceId": "EA6zEIgBjUxcCLs3cTmbtaSrYONBaxOE32tb6R7qehFx"
        },
        "publicKeys": {
          "current": "1AAIArB9u6gWx3Z0P5Vbe0aaUkZQnjEQBBtDpKxIz7nP0DK0",
          "nextDigest": "EAOyvIuMWvAeCTUA1AGJEtHugAE8FzwZCqjYC17YkTqN"
        }
      }
    }
  },
  "signature": "0IDom3xtL7-XjJl2K8RdEa4H5q2kXEr5ch2nFfCtpCxzJvwSgueeycQL2Xw3ZCAA6JnxZeemO3WJR9xYd7aXToKW"
}
```

response

```json
{
  "payload": {
    "access": {
      "responseKeyDigest": "ELB2mEllbn4s7uAga99YwAj7LDJg2ZCvKI4I5AbO_Ke7",
      "nonce": "0ACoZY_yInf7yc7n4xBO_UAo"
    },
    "response": {}
  },
  "signature": "0ICthdy7VhUmYuigB4x7Fv5N_s_5bHdBrQZwFk-Glke2xOF3iSa0KKxn_PLX5HkwCOsyUF5P04RDhl5-7vt5ogYB"
}
```

### Rotation

request

```json
{
  "payload": {
    "access": {
      "nonce": "0AADpywt409lm3Lqf3Or1QO2"
    },
    "identification": {
      "accountId": "EPDNrcAWe_HRr2pxuKJ2Op7pldgUDJlMP1p5zIopOzx6",
      "deviceId": "EFwbPxaFzhbgCLOjaQucojOnPjk3flP0GuDznsQJ__8z"
    },
    "authentication": {
      "publicKeys": {
        "current": "1AAIAgOrCpm9x_X09GOUtt2N0fM4cUZpWey2LIbxGt2QZ3NW",
        "nextDigest": "EDusjB6wOeEj_F19OkRikjpdD_wBK9YtWqqWahwoKwU7"
      }
    }
  },
  "signature": "0ICbUi38fsiwjgBgNu-rD2IkrTPsMHywAD1YRnS6Co6g8gAEFIglNEvv9lgXw8_t6w91fYKFY9VUqsLamoV5dmci"
}
```

response

```json
{
  "payload": {
    "access": {
      "responseKeyDigest": "ELB2mEllbn4s7uAga99YwAj7LDJg2ZCvKI4I5AbO_Ke7",
      "nonce": "0AADpywt409lm3Lqf3Or1QO2"
    },
    "response": {}
  },
  "signature": "0ICaUD9iD5MN8TmoMpSQ8VwmA0qlaAdnwrhOKQQ847US60UnRPq9SXGRHbSs2Dn41GVSnHyQ3vYRm9giIbH_sKEt"
}
```

### Authentication

request (request for challenge)

```json
{
  "payload": {
    "access": {
      "nonce": "0AAg_1LWQAyrGB__yKEPQfyd"
    },
    "identification": {
      "accountId": "EPDNrcAWe_HRr2pxuKJ2Op7pldgUDJlMP1p5zIopOzx6"
    }
  }
}
```

response (challenge)

```json
{
  "payload": {
    "access": {
      "responseKeyDigest": "ELB2mEllbn4s7uAga99YwAj7LDJg2ZCvKI4I5AbO_Ke7",
      "nonce": "0AAg_1LWQAyrGB__yKEPQfyd"
    },
    "response": {
      "authentication": {
        "nonce": "0ABOWgH1hwvu0FGJI8J1Rj_j"
      }
    }
  },
  "signature": "0IBA0mMcASSn9LF04CsZ312So-Ktmw22e14OFQfTl0vKDfZuLEMDrHrvslf4aIpHEuue2t5qx6P2Z7N1wGgDmIyT"
}
```

request (response to challenge)

```json
{
  "payload": {
    "access": {
      "nonce": "0AClPn-p9h41yjs5KS9Wbrcx",
      "publicKeys": {
        "current": "1AAIAwgalkNxZ43X59j-6h6RtcN9JJsUSp2GYQgKf5-BREOJ",
        "nextDigest": "ELdvr-Vdu5oLLaPRyJ3jv61icpK6ffllSBd_qY2pTrRm"
      }
    },
    "authentication": {
      "nonce": "0ABOWgH1hwvu0FGJI8J1Rj_j"
    },
    "identification": {
      "deviceId": "EFwbPxaFzhbgCLOjaQucojOnPjk3flP0GuDznsQJ__8z"
    }
  },
  "signature": "0IAKuhVuy5M6hHNoj4o7VLdqZOSduJzgVixsFgbHJ-vi0Ic0NxwW_VH9eogkZrKDI8uPfz5Im9Go8ZXUreuXuM7g"
}

response (grant)

{
  "payload": {
    "access": {
      "responseKeyDigest": "ELB2mEllbn4s7uAga99YwAj7LDJg2ZCvKI4I5AbO_Ke7",
      "nonce": "0AClPn-p9h41yjs5KS9Wbrcx"
    },
    "response": {
      "access": {
        "token": "0ID4fxJEiPALq1xIaV1uWofloqY9prNgUSImTTd6tjwQ7CJrym9zZqkhR3uX1FlL_uHGdEycRlQB_dW-q4qppgfQH4sIAAAAAAACA23OXW-CMBQG4P_S67FAgRq4w2g2wYHDj02XxSAtWFega4uCxv--uls9lyfv855zAVmeN22tJhj4YDwbxSIPPsj2NRWQd20UwoQPOMPlchSyt5nF3fOk4cm5Q-AJ8HbHaB6RXlMrCCbBqczYT9xtHPvT9Q4G2qNU5bEXhnI55_Bl_V5GhWsM03ESal6TTo1oSaS6nZ7iozBWuHWb6TSbpX1oH47IojmPUFEwNh_i7e8a8oVIK22plC3BwU1CE7qG6RnQWZiWD5HvDJ5d5Jj_s9FZ0nEq-rukY90lBSkEkfvxA2DZj6ozpQTdtYpI4F8AJ6LSj9GmlsM-bRi5LTNc0Rr4X7o8w5qcBFUEfF-v1z8CFFnGfAEAAA"
      }
    }
  },
  "signature": "0IDE0_gyOP8oelwBRYq3Ju516h1MUk3giUSC1qe2KpQt3eygl5e05Xc9S2yk3pFIb_Ow91hlA98kMzjSlTu8fvfB"
}
```

### Refresh

this rotates the access key

request

```json
{
  "payload": {
    "access": {
      "nonce": "0ABoSrSA9849rvUndbZlQZN6",
      "publicKeys": {
        "current": "1AAIAn5FoxgMv6ehzqTH6PqsPNNzizuF39s8CPtJpKwQep7-",
        "nextDigest": "EF5b9I4cPJ9s-1oP54xYfb4fCIeJkR1TeMV2y-Q4LQdu"
      },
      "token": "0ID4fxJEiPALq1xIaV1uWofloqY9prNgUSImTTd6tjwQ7CJrym9zZqkhR3uX1FlL_uHGdEycRlQB_dW-q4qppgfQH4sIAAAAAAACA23OXW-CMBQG4P_S67FAgRq4w2g2wYHDj02XxSAtWFega4uCxv--uls9lyfv855zAVmeN22tJhj4YDwbxSIPPsj2NRWQd20UwoQPOMPlchSyt5nF3fOk4cm5Q-AJ8HbHaB6RXlMrCCbBqczYT9xtHPvT9Q4G2qNU5bEXhnI55_Bl_V5GhWsM03ESal6TTo1oSaS6nZ7iozBWuHWb6TSbpX1oH47IojmPUFEwNh_i7e8a8oVIK22plC3BwU1CE7qG6RnQWZiWD5HvDJ5d5Jj_s9FZ0nEq-rukY90lBSkEkfvxA2DZj6ozpQTdtYpI4F8AJ6LSj9GmlsM-bRi5LTNc0Rr4X7o8w5qcBFUEfF-v1z8CFFnGfAEAAA"
    }
  },
  "signature": "0ICmJA9wwYP-Nds1e6KVL71tLj1fuTfe4bCeLO2zoXOfALLU4EQW7p-YtS8SBLa_b6eUPVr6ECJzn9QqH2bRJe7Y"
}
```

response (new token)

```json
{
  "payload": {
    "access": {
      "responseKeyDigest": "ELB2mEllbn4s7uAga99YwAj7LDJg2ZCvKI4I5AbO_Ke7",
      "nonce": "0ABoSrSA9849rvUndbZlQZN6"
    },
    "response": {
      "access": {
        "token": "0IAJOs71kH2IAWzZsa1JUADRTtGlv5lZ6hCpLTD4AnhQssYCyS4aHaBdv3ojuGxB25HY_dtTNbW5v3PFGsy5FDIbH4sIAAAAAAACA23O207CQBAG4HfZa2u6y7bY3lUOoUVgIahRY0wPA2ws7bIHaUt4dxcv9ALncvJ__8wJpXlem0rHBQrRiA3nMo-e4WOykkQ0ZpqQheiLstg-DpNyxrDwurgWi67x0Q0SJit5PoXWUhxFcVR547rZzr582HWH9cRnB8Xm8453ZtwL1N2A6URMj0sQfcfyCho95FtQ-nJ67GVBTHOWBMrBNfNo87LJ6GYQQ_K5wmuYPZHWWdKHZWGs5UoZKKKLJC7xHDdwCF27OCR-SPu3nh-4P_Nqs9AILturJMVXSQkbCWo3-gfg3m81_QOp1pJnRoNC4QkJkHv7GK8rdd-u6hIuy7TY8wqFb7Y8LSw5Sq4BvZ_P5294eKQtfAEAAA"
      }
    }
  },
  "signature": "0ICGaOht4XmI6vHZJ7vN9AhbQHhkV138LDAdAbgt6A32fdxrkbSplgfkl5MvCBQb0tMCfgFW_3si5QhgU9YoSRvg"
}
```

### Access

request

```json
{
  "payload": {
    "token": "0IAJOs71kH2IAWzZsa1JUADRTtGlv5lZ6hCpLTD4AnhQssYCyS4aHaBdv3ojuGxB25HY_dtTNbW5v3PFGsy5FDIbH4sIAAAAAAACA23O207CQBAG4HfZa2u6y7bY3lUOoUVgIahRY0wPA2ws7bIHaUt4dxcv9ALncvJ__8wJpXlem0rHBQrRiA3nMo-e4WOykkQ0ZpqQheiLstg-DpNyxrDwurgWi67x0Q0SJit5PoXWUhxFcVR547rZzr582HWH9cRnB8Xm8453ZtwL1N2A6URMj0sQfcfyCho95FtQ-nJ67GVBTHOWBMrBNfNo87LJ6GYQQ_K5wmuYPZHWWdKHZWGs5UoZKKKLJC7xHDdwCF27OCR-SPu3nh-4P_Nqs9AILturJMVXSQkbCWo3-gfg3m81_QOp1pJnRoNC4QkJkHv7GK8rdd-u6hIuy7TY8wqFb7Y8LSw5Sq4BvZ_P5294eKQtfAEAAA",
    "access": {
      "timestamp": "2025-09-24T01:26:47.570000000Z",
      "nonce": "0ADobgjsxFItSI18kccfpcoX"
    },
    "request": {
      "foo": "bar",
      "bar": "foo"
    }
  },
  "signature": "0IAVbRXovMnC1KQnT6ML_zbhs67RupiwrEKPTqFsiyjpAzyKHvd-JRq6gItf_4Z3Z8JdsCmXYYyfUQMYrbh3FnC5"
}
```

response

```json
{
  "payload": {
    "access": {
      "responseKeyDigest": "1AAIA9UFbK7u22xJB61JKE2SXdqEbAGkONb9mGCmf3DXEzCh",
      "nonce": "0ADobgjsxFItSI18kccfpcoX"
    },
    "response": {
      "wasFoo": "bar",
      "wasBar": "foo"
    }
  },
  "signature": "0ICsgjF3WVVRx-BQh5iQbgLSKhSgJXaATklTTiIgvpRtrQSUTU_Ki1iWTsO9-S7KV2ib7-KRROnkxet80b3TRSCo"
}
```
